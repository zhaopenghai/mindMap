<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>初级会计实务 - 考点导图</title>
    <style>
      /* --- 全局重置 --- */
      * {
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
      }
      body,
      html {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial,
          sans-serif;
        background-color: #f0f2f5;
      }

      /* --- 背景点阵网格 (参考图样式) --- */
      .grid-bg {
        position: absolute;
        width: 100%;
        height: 100%;
        background-image: radial-gradient(#d1d5db 1.5px, transparent 1.5px);
        background-size: 24px 24px;
        z-index: 0;
      }

      /* --- 视口与画布 --- */
      #viewport {
        width: 100%;
        height: 100%;
        position: relative;
        overflow: hidden;
        touch-action: none;
        cursor: grab;
        z-index: 1;
      }
      #canvas {
        position: absolute;
        top: 0;
        left: 0;
        transform-origin: 0 0;
        will-change: transform;
        transform: translateZ(0);
        -webkit-transform: translateZ(0);
      }

      /* --- SVG 连线层 --- */
      svg {
        position: absolute;
        top: 0;
        left: 0;
        overflow: visible;
        pointer-events: none;
        z-index: 1;
      }
      path.connection {
        fill: none;
        stroke: #bdc3c7;
        stroke-width: 2px;
      }

      /* --- 节点通用样式 --- */
      .node {
        position: absolute;
        z-index: 2;
        display: flex;
        align-items: center;
      }

      /* 1. 根节点 & 中间层级 (深色胶囊样式) */
      .node-pill {
        background-color: #34495e;
        color: white;
        padding: 10px 12px;
        border-radius: 8px;
        font-size: 12px;
        font-weight: 600;
        box-shadow: 0 4px 10px rgba(44, 62, 80, 0.3);
        cursor: pointer;
        border: 1px solid #2c3e50;

        width: 146px;

        /* 多行省略核心 */
        display: -webkit-box;
        -webkit-box-orient: vertical;
        -webkit-line-clamp: 2;

        overflow: hidden;
        word-break: break-word;
      }

      .is-root .node-pill {
        font-size: 12px;
        /*padding: 12px 24px;*/
        background-color: #2c3e50;
      }

      /* 2. 叶子节点 (白色卡片样式) */
      .node-card {
        background: white;
        width: 260px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        border-left: 5px solid #3498db;
        padding: 12px 14px;
        cursor: default;
      }
      .card-title {
        font-size: 15px;
        font-weight: bold;
        color: #333;
        margin-bottom: 6px;
      }
      .card-desc {
        font-size: 12px;
        color: #666;
        line-height: 1.5;
        margin-bottom: 12px;
      }

      .card-actions {
        display: flex;
        gap: 10px;
      }
      .action-btn {
        flex: 1;
        background: #f7f9fa;
        border: none;
        border-radius: 4px;
        padding: 6px 0;
        font-size: 12px;
        color: #3498db;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 4px;
        font-weight: 600;
        cursor: pointer;
      }

      /* --- 折叠/展开 按钮 --- */
      .toggle-btn {
        position: absolute;
        right: -12px;
        top: 50%;
        transform: translateY(-50%);
        width: 20px;
        height: 20px;
        background: #95a5a6;
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        border: 2px solid #f0f2f5;
        cursor: pointer;
        z-index: 10;
      }
      .toggle-btn.collapsed {
        background: #3498db;
      }

      /* --- 主控制栏 --- */
      .main-controls {
        display: flex;
        flex-direction: column;
        justify-content: space-evenly;
        background-color: rgba(0, 0, 0, 0.5);
        border-radius: 20px;
        width: 40px;
        height: 180px;
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 100;
      }

      .control-btn {
        background-color: transparent;
        border: none;
        cursor: pointer;
        position: relative;
      }

      .control-btn-img {
        width: 20px;
        height: 20px;
        pointer-events: none;
      }

      /* --- 展开/折叠切换按钮样式 --- */
      #toggle-expand-btn {
        position: relative;
      }

      #toggle-expand-btn .control-btn-img {
        width: 20px;
        height: 20px;
        transition: opacity 0.3s ease;
      }

      #toggle-expand-btn .zk-icon {
        opacity: 1;
        visibility: visible;
      }

      #toggle-expand-btn .sx-icon {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        opacity: 0;
        visibility: hidden;
      }

      #toggle-expand-btn.expanded .zk-icon {
        opacity: 0;
        visibility: hidden;
      }

      #toggle-expand-btn.expanded .sx-icon {
        opacity: 1;
        visibility: visible;
      }

      #toggle-expand-btn.collapsed .zk-icon {
        opacity: 1;
        visibility: visible;
      }

      #toggle-expand-btn.collapsed .sx-icon {
        opacity: 0;
        visibility: hidden;
      }

      /* --- 重置视图按钮 --- */
      .reset-view-btn {
        position: fixed;
        bottom: 20px;
        left: 20px;
        background: white;
        border: none;
        border-radius: 8px;
        padding: 8px 16px;
        font-size: 14px;
        font-weight: 600;
        color: #34495e;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        cursor: pointer;
        z-index: 100;
        transition: all 0.2s ease;
      }

      .reset-view-btn:hover {
        background-color: #f7f9fa;
        transform: translateY(-1px);
      }

      .reset-view-btn:active {
        transform: translateY(1px);
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* --- RN通信调试面板 --- */
      .rn-debug {
        position: fixed;
        top: 10px;
        right: 10px;
        background: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 8px;
        border-radius: 4px;
        font-size: 12px;
        z-index: 10000;
        display: none;
        max-width: 200px;
        word-break: break-all;
      }
    </style>
  </head>
  <body>
    <div class="grid-bg"></div>

    <div id="viewport">
      <div id="canvas">
        <svg id="svg-layer"></svg>
        <div id="dom-layer"></div>
      </div>
    </div>

    <!-- 主控制栏（4个图标按钮） -->
    <div class="main-controls">
      <!-- 放大 -->
      <button class="control-btn" id="zoom-in-btn">
        <img src="./assets/fd.png" alt="放大" class="control-btn-img" />
      </button>

      <!-- 缩小 -->
      <button class="control-btn" id="zoom-out-btn">
        <img src="./assets/ss.png" alt="缩小" class="control-btn-img" />
      </button>

      <!-- 展开/折叠切换按钮 -->
      <button class="control-btn" id="toggle-expand-btn">
        <img src="./assets/zk.png" alt="展开全部" class="control-btn-img zk-icon" />
        <img src="./assets/sx.png" alt="折叠全部" class="control-btn-img sx-icon" />
      </button>

      <!-- 下载完整导图 -->
      <button class="control-btn" id="download-full-btn">
        <img src="./assets/xizai.png" alt="下载完整导图" class="control-btn-img" />
      </button>
    </div>

    <!-- 重置视图按钮（单独保留） -->
    <button class="reset-view-btn" id="zoom-reset">重置视图</button>

    <!-- RN通信调试面板 -->
    <div class="rn-debug" id="rn-debug"></div>

    <script>
      // --- 1. 数据源 ---
      let mindMapData = {
        id: 'root',
        type: 'root',
        text: '初级会计实务',
        children: [],
      };

      // let mindMapData = {"id":"1","type":"root","text":"绪论","children":[{"id":"1-1","type":"branch","text":"气血津液病证","children":[{"id":"1-1-1","type":"branch","text":"郁证","children":[{"id":"1-1-1-1","type":"branch","text":"概述","children":[]},{"id":"1-1-1-2","type":"branch","text":"病因病机","children":[{"id":"1-1-1-2-1","type":"leaf","title":"病因"},{"id":"1-1-1-2-2","type":"leaf","title":"病机"}]},{"id":"1-1-1-3","type":"branch","text":"诊断与鉴别诊断","children":[{"id":"1-1-1-3-1","type":"leaf","title":"诊断依据"},{"id":"1-1-1-3-2","type":"leaf","title":"鉴别诊断"}]},{"id":"1-1-1-4","type":"branch","text":"辨证论治","children":[{"id":"1-1-1-4-1","type":"branch","text":"辨证要点","children":[]},{"id":"1-1-1-4-2","type":"branch","text":"治疗原则","children":[]},{"id":"1-1-1-4-3","type":"branch","text":"证治分类","children":[{"id":"1-1-1-4-3-1","type":"leaf","title":"肝气郁结证"},{"id":"1-1-1-4-3-2","type":"leaf","title":"气郁化火证"},{"id":"1-1-1-4-3-3","type":"leaf","title":"痰气郁结证"},{"id":"1-1-1-4-3-4","type":"leaf","title":"心神失养证"},{"id":"1-1-1-4-3-5","type":"leaf","title":"心脾两虚证"},{"id":"1-1-1-4-3-6","type":"leaf","title":"心肾阴虚证"}]}]},{"id":"1-1-1-5","type":"branch","text":"预防调护","children":[]}]},{"id":"1-1-2","type":"branch","text":"血证","children":[{"id":"1-1-2-1","type":"branch","text":"概述","children":[]},{"id":"1-1-2-2","type":"branch","text":"病因病机","children":[{"id":"1-1-2-2-1","type":"leaf","title":"病因"},{"id":"1-1-2-2-2","type":"leaf","title":"病机"}]},{"id":"1-1-2-3","type":"branch","text":"诊断与鉴别诊断","children":[{"id":"1-1-2-3-1","type":"branch","text":"诊断依据","children":[{"id":"1-1-2-3-1-1","type":"leaf","title":"鼻衄"},{"id":"1-1-2-3-1-2","type":"leaf","title":"齿衄"},{"id":"1-1-2-3-1-3","type":"leaf","title":"咳血"},{"id":"1-1-2-3-1-4","type":"leaf","title":"吐血"},{"id":"1-1-2-3-1-5","type":"leaf","title":"便血"},{"id":"1-1-2-3-1-6","type":"leaf","title":"尿血"},{"id":"1-1-2-3-1-7","type":"leaf","title":"紫斑"}]},{"id":"1-1-2-3-2","type":"branch","text":"鉴别诊断","children":[{"id":"1-1-2-3-2-1","type":"leaf","title":"鼻衄"},{"id":"1-1-2-3-2-2","type":"leaf","title":"齿衄"},{"id":"1-1-2-3-2-3","type":"leaf","title":"咳血"},{"id":"1-1-2-3-2-4","type":"leaf","title":"吐血"},{"id":"1-1-2-3-2-5","type":"leaf","title":"便血"},{"id":"1-1-2-3-2-6","type":"leaf","title":"尿血"},{"id":"1-1-2-3-2-7","type":"leaf","title":"紫斑"}]}]},{"id":"1-1-2-4","type":"branch","text":"辨证论治","children":[{"id":"1-1-2-4-1","type":"branch","text":"辨证要点","children":[]},{"id":"1-1-2-4-2","type":"branch","text":"治疗原则","children":[]},{"id":"1-1-2-4-3","type":"branch","text":"证治分类","children":[{"id":"1-1-2-4-3-1","type":"branch","text":"鼻衄","children":[{"id":"1-1-2-4-3-1-1","type":"leaf","title":"热邪犯肺证"},{"id":"1-1-2-4-3-1-2","type":"leaf","title":"胃热炽盛证"},{"id":"1-1-2-4-3-1-3","type":"leaf","title":"肝火上炎证"},{"id":"1-1-2-4-3-1-4","type":"leaf","title":"气血亏虚证"}]},{"id":"1-1-2-4-3-2","type":"branch","text":"齿衄","children":[{"id":"1-1-2-4-3-2-1","type":"leaf","title":"胃火炽盛证"},{"id":"1-1-2-4-3-2-2","type":"leaf","title":"阴虚火旺证"}]},{"id":"1-1-2-4-3-3","type":"branch","text":"咳血","children":[{"id":"1-1-2-4-3-3-1","type":"leaf","title":"燥热伤肺证"},{"id":"1-1-2-4-3-3-2","type":"leaf","title":"肝火犯肺证"},{"id":"1-1-2-4-3-3-3","type":"leaf","title":"阴虚肺热证"}]},{"id":"1-1-2-4-3-4","type":"branch","text":"吐血","children":[{"id":"1-1-2-4-3-4-1","type":"leaf","title":"胃热壅盛证"},{"id":"1-1-2-4-3-4-2","type":"leaf","title":"肝火犯胃证"},{"id":"1-1-2-4-3-4-3","type":"leaf","title":"气虚血溢证"}]},{"id":"1-1-2-4-3-5","type":"branch","text":"便血","children":[{"id":"1-1-2-4-3-5-1","type":"leaf","title":"肠道湿热证"},{"id":"1-1-2-4-3-5-2","type":"leaf","title":"热灼胃络证"},{"id":"1-1-2-4-3-5-3","type":"leaf","title":"气虚不摄证"}]},{"id":"1-1-2-4-3-6","type":"branch","text":"尿血","children":[{"id":"1-1-2-4-3-6-1","type":"leaf","title":"下焦湿热证"},{"id":"1-1-2-4-3-6-2","type":"leaf","title":"肾虚火旺证"},{"id":"1-1-2-4-3-6-3","type":"leaf","title":"脾不统血证"},{"id":"1-1-2-4-3-6-4","type":"leaf","title":"肾气不固证"}]},{"id":"1-1-2-4-3-7","type":"branch","text":"紫斑","children":[{"id":"1-1-2-4-3-7-1","type":"leaf","title":"血热妄行证"},{"id":"1-1-2-4-3-7-2","type":"leaf","title":"阴虚火旺证"},{"id":"1-1-2-4-3-7-3","type":"leaf","title":"气不摄血证"}]}]}]},{"id":"1-1-2-5","type":"branch","text":"转归预后","children":[]},{"id":"1-1-2-6","type":"branch","text":"预防调护","children":[]}]},{"id":"1-1-3","type":"branch","text":"痰饮","children":[{"id":"1-1-3-1","type":"branch","text":"概述","children":[]},{"id":"1-1-3-2","type":"branch","text":"分类","children":[]},{"id":"1-1-3-3","type":"branch","text":"病因病机","children":[{"id":"1-1-3-3-1","type":"leaf","title":"病因"},{"id":"1-1-3-3-2","type":"leaf","title":"病机"}]},{"id":"1-1-3-4","type":"branch","text":"辨证论治","children":[{"id":"1-1-3-4-1","type":"branch","text":"辨证要点","children":[]},{"id":"1-1-3-4-2","type":"branch","text":"治疗原则","children":[]},{"id":"1-1-3-4-3","type":"branch","text":"证治分类","children":[{"id":"1-1-3-4-3-1","type":"branch","text":"痰饮","children":[{"id":"1-1-3-4-3-1-1","type":"leaf","title":"脾阳虚弱证"},{"id":"1-1-3-4-3-1-2","type":"leaf","title":"饮留胃肠证"}]},{"id":"1-1-3-4-3-2","type":"branch","text":"悬饮","children":[{"id":"1-1-3-4-3-2-1","type":"leaf","title":"邪犯胸肺证"},{"id":"1-1-3-4-3-2-2","type":"leaf","title":"饮停胸胁证"},{"id":"1-1-3-4-3-2-3","type":"leaf","title":"络气不和证"},{"id":"1-1-3-4-3-2-4","type":"leaf","title":"阴虚内热证"}]},{"id":"1-1-3-4-3-3","type":"branch","text":"溢饮","children":[{"id":"1-1-3-4-3-3-1","type":"leaf","title":"表寒里饮证"}]},{"id":"1-1-3-4-3-4","type":"branch","text":"支饮","children":[{"id":"1-1-3-4-3-4-1","type":"leaf","title":"寒饮伏肺证"},{"id":"1-1-3-4-3-4-2","type":"leaf","title":"脾肾阳虚证"}]}]}]}]},{"id":"1-1-4","type":"branch","text":"消渴","children":[{"id":"1-1-4-1","type":"branch","text":"概述","children":[]},{"id":"1-1-4-2","type":"branch","text":"病因病机","children":[{"id":"1-1-4-2-1","type":"leaf","title":"病因"},{"id":"1-1-4-2-2","type":"leaf","title":"病机"}]},{"id":"1-1-4-3","type":"branch","text":"诊断与鉴别诊断","children":[{"id":"1-1-4-3-1","type":"leaf","title":"诊断依据"},{"id":"1-1-4-3-2","type":"leaf","title":"鉴别诊断"}]},{"id":"1-1-4-4","type":"branch","text":"辨证论治","children":[{"id":"1-1-4-4-1","type":"branch","text":"辨证要点","children":[]},{"id":"1-1-4-4-2","type":"branch","text":"治疗原则","children":[]},{"id":"1-1-4-4-3","type":"branch","text":"证治分类","children":[{"id":"1-1-4-4-3-1","type":"branch","text":"上消","children":[{"id":"1-1-4-4-3-1-1","type":"leaf","title":"肺热津伤证"}]},{"id":"1-1-4-4-3-2","type":"branch","text":"中消","children":[{"id":"1-1-4-4-3-2-1","type":"leaf","title":"胃热炽盛证"},{"id":"1-1-4-4-3-2-2","type":"leaf","title":"气阴亏虚证"}]},{"id":"1-1-4-4-3-3","type":"branch","text":"下消","children":[{"id":"1-1-4-4-3-3-1","type":"leaf","title":"肾阴亏虚证"},{"id":"1-1-4-4-3-3-2","type":"leaf","title":"阴阳两虚证"}]}]}]},{"id":"1-1-4-5","type":"branch","text":"转归预后","children":[]},{"id":"1-1-4-6","type":"branch","text":"预防调护","children":[]}]},{"id":"1-1-5","type":"branch","text":"汗证","children":[{"id":"1-1-5-1","type":"branch","text":"概述","children":[]},{"id":"1-1-5-2","type":"branch","text":"病因病机","children":[{"id":"1-1-5-2-1","type":"leaf","title":"病因"},{"id":"1-1-5-2-2","type":"leaf","title":"病机"}]},{"id":"1-1-5-3","type":"branch","text":"诊断与鉴别诊断","children":[{"id":"1-1-5-3-1","type":"leaf","title":"诊断依据"},{"id":"1-1-5-3-2","type":"leaf","title":"鉴别诊断"}]},{"id":"1-1-5-4","type":"branch","text":"辨证论治","children":[{"id":"1-1-5-4-1","type":"branch","text":"辨证要点","children":[]},{"id":"1-1-5-4-2","type":"branch","text":"治疗原则","children":[]},{"id":"1-1-5-4-3","type":"branch","text":"证治分类","children":[{"id":"1-1-5-4-3-1","type":"leaf","title":"肺卫不固证"},{"id":"1-1-5-4-3-2","type":"leaf","title":"心血不足证"},{"id":"1-1-5-4-3-3","type":"leaf","title":"阴虚火旺证"},{"id":"1-1-5-4-3-4","type":"leaf","title":"邪热郁蒸证"}]}]}]},{"id":"1-1-6","type":"branch","text":"内伤发热","children":[{"id":"1-1-6-1","type":"branch","text":"概述","children":[]},{"id":"1-1-6-2","type":"branch","text":"病因病机","children":[{"id":"1-1-6-2-1","type":"leaf","title":"病因"},{"id":"1-1-6-2-2","type":"leaf","title":"病机"}]},{"id":"1-1-6-3","type":"branch","text":"诊断","children":[]},{"id":"1-1-6-4","type":"branch","text":"辨证论治","children":[{"id":"1-1-6-4-1","type":"branch","text":"辨证要点","children":[]},{"id":"1-1-6-4-2","type":"branch","text":"治疗原则","children":[]},{"id":"1-1-6-4-3","type":"branch","text":"证治分类","children":[{"id":"1-1-6-4-3-1","type":"leaf","title":"阴虚发热证"},{"id":"1-1-6-4-3-2","type":"leaf","title":"血虚发热证"},{"id":"1-1-6-4-3-3","type":"leaf","title":"气虚发热证"},{"id":"1-1-6-4-3-4","type":"leaf","title":"阳虚发热证"},{"id":"1-1-6-4-3-5","type":"leaf","title":"气郁发热证"},{"id":"1-1-6-4-3-6","type":"leaf","title":"痰湿郁热证"},{"id":"1-1-6-4-3-7","type":"leaf","title":"血瘀发热证"}]}]}]},{"id":"1-1-7","type":"branch","text":"虚劳","children":[{"id":"1-1-7-1","type":"branch","text":"概述","children":[]},{"id":"1-1-7-2","type":"branch","text":"病因病机","children":[{"id":"1-1-7-2-1","type":"leaf","title":"病因"},{"id":"1-1-7-2-2","type":"leaf","title":"病机"}]},{"id":"1-1-7-3","type":"branch","text":"诊断与鉴别诊断","children":[{"id":"1-1-7-3-1","type":"leaf","title":"诊断依据"},{"id":"1-1-7-3-2","type":"leaf","title":"鉴别诊断"}]},{"id":"1-1-7-4","type":"branch","text":"辨证论治","children":[{"id":"1-1-7-4-1","type":"branch","text":"辨证要点","children":[]},{"id":"1-1-7-4-2","type":"branch","text":"治疗原则","children":[]},{"id":"1-1-7-4-3","type":"branch","text":"证治分类","children":[{"id":"1-1-7-4-3-1","type":"branch","text":"气虚","children":[{"id":"1-1-7-4-3-1-1","type":"leaf","title":"肺气虚证"},{"id":"1-1-7-4-3-1-2","type":"leaf","title":"心气虚证"},{"id":"1-1-7-4-3-1-3","type":"leaf","title":"脾气虚证"},{"id":"1-1-7-4-3-1-4","type":"leaf","title":"肾气虚证"}]},{"id":"1-1-7-4-3-2","type":"branch","text":"血虚","children":[{"id":"1-1-7-4-3-2-1","type":"leaf","title":"心血虚证"},{"id":"1-1-7-4-3-2-2","type":"leaf","title":"肝血虚证"}]},{"id":"1-1-7-4-3-3","type":"branch","text":"阴虚","children":[{"id":"1-1-7-4-3-3-1","type":"leaf","title":"肺阴虚证"},{"id":"1-1-7-4-3-3-2","type":"leaf","title":"心阴虚证"},{"id":"1-1-7-4-3-3-3","type":"leaf","title":"脾胃阴虚证"},{"id":"1-1-7-4-3-3-4","type":"leaf","title":"肝阴虚证"},{"id":"1-1-7-4-3-3-5","type":"leaf","title":"肾阴虚证"}]},{"id":"1-1-7-4-3-4","type":"branch","text":"阳虚","children":[{"id":"1-1-7-4-3-4-1","type":"leaf","title":"心阳虚证"},{"id":"1-1-7-4-3-4-2","type":"leaf","title":"脾阳虚证"},{"id":"1-1-7-4-3-4-3","type":"leaf","title":"肾阳虚证"}]}]}]},{"id":"1-1-7-5","type":"branch","text":"转归预后","children":[]}]},{"id":"1-1-8","type":"branch","text":"癌病","children":[{"id":"1-1-8-1","type":"branch","text":"概述","children":[]},{"id":"1-1-8-2","type":"branch","text":"病因病机","children":[{"id":"1-1-8-2-1","type":"leaf","title":"病因"},{"id":"1-1-8-2-2","type":"leaf","title":"病机"}]},{"id":"1-1-8-3","type":"branch","text":"诊断与鉴别诊断","children":[{"id":"1-1-8-3-1","type":"leaf","title":"诊断依据"},{"id":"1-1-8-3-2","type":"leaf","title":"鉴别诊断"}]}]}]},{"id":"1-2","type":"branch","text":"肝胆病证","children":[{"id":"1-2-1","type":"branch","text":"胁痛","children":[{"id":"1-2-1-1","type":"branch","text":"概述","children":[]},{"id":"1-2-1-2","type":"branch","text":"病因病机","children":[{"id":"1-2-1-2-1","type":"leaf","title":"病因"},{"id":"1-2-1-2-2","type":"leaf","title":"病机"}]},{"id":"1-2-1-3","type":"branch","text":"诊断与鉴别诊断","children":[{"id":"1-2-1-3-1","type":"leaf","title":"诊断要点"},{"id":"1-2-1-3-2","type":"leaf","title":"鉴别诊断"}]},{"id":"1-2-1-4","type":"branch","text":"辨证论治","children":[{"id":"1-2-1-4-1","type":"branch","text":"辨证要点","children":[]},{"id":"1-2-1-4-2","type":"branch","text":"治疗原则","children":[]},{"id":"1-2-1-4-3","type":"branch","text":"证治分类","children":[{"id":"1-2-1-4-3-1","type":"leaf","title":"肝郁气滞证"},{"id":"1-2-1-4-3-2","type":"leaf","title":"肝胆湿热证"},{"id":"1-2-1-4-3-3","type":"leaf","title":"瘀血阻络证"},{"id":"1-2-1-4-3-4","type":"leaf","title":"肝络失养证"}]}]},{"id":"1-2-1-5","type":"branch","text":"转归预后","children":[]}]},{"id":"1-2-2","type":"branch","text":"黄疸","children":[{"id":"1-2-2-1","type":"branch","text":"概述","children":[]},{"id":"1-2-2-2","type":"branch","text":"病因病机","children":[{"id":"1-2-2-2-1","type":"leaf","title":"病因"},{"id":"1-2-2-2-2","type":"leaf","title":"病机"}]},{"id":"1-2-2-3","type":"branch","text":"诊断与鉴别诊断","children":[{"id":"1-2-2-3-1","type":"leaf","title":"诊断依据"},{"id":"1-2-2-3-2","type":"leaf","title":"鉴别诊断"}]},{"id":"1-2-2-4","type":"branch","text":"辨证论治","children":[{"id":"1-2-2-4-1","type":"branch","text":"辨证要点","children":[]},{"id":"1-2-2-4-2","type":"branch","text":"治疗原则","children":[]},{"id":"1-2-2-4-3","type":"branch","text":"证治分类","children":[{"id":"1-2-2-4-3-1","type":"branch","text":"阳黄","children":[{"id":"1-2-2-4-3-1-1","type":"leaf","title":"热重于湿证"},{"id":"1-2-2-4-3-1-2","type":"leaf","title":"湿重于热证"},{"id":"1-2-2-4-3-1-3","type":"leaf","title":"胆腑郁热证"},{"id":"1-2-2-4-3-1-4","type":"leaf","title":"疫毒炽盛证(急黄)"}]},{"id":"1-2-2-4-3-2","type":"branch","text":"阴黄","children":[{"id":"1-2-2-4-3-2-1","type":"leaf","title":"寒湿阻遏证"},{"id":"1-2-2-4-3-2-2","type":"leaf","title":"脾虚湿滞证"}]},{"id":"1-2-2-4-3-3","type":"branch","text":"黄疸消退后的调治","children":[{"id":"1-2-2-4-3-3-1","type":"leaf","title":"湿热留恋证"},{"id":"1-2-2-4-3-3-2","type":"leaf","title":"肝脾不调证"},{"id":"1-2-2-4-3-3-3","type":"leaf","title":"气滞血瘀证"}]}]}]}]},{"id":"1-2-3","type":"branch","text":"积证","children":[{"id":"1-2-3-1","type":"branch","text":"概述","children":[]},{"id":"1-2-3-2","type":"branch","text":"病因病机","children":[{"id":"1-2-3-2-1","type":"leaf","title":"病因"},{"id":"1-2-3-2-2","type":"leaf","title":"病机"}]}]},{"id":"1-2-4","type":"branch","text":"聚证","children":[{"id":"1-2-4-1","type":"branch","text":"概述","children":[]},{"id":"1-2-4-2","type":"branch","text":"病因病机","children":[{"id":"1-2-4-2-1","type":"leaf","title":"病因"},{"id":"1-2-4-2-2","type":"leaf","title":"病机"}]}]}]},{"id":"1-3","type":"branch","text":"肢体经络病证","children":[{"id":"1-3-1","type":"branch","text":"痹证","children":[{"id":"1-3-1-1","type":"branch","text":"概述","children":[]},{"id":"1-3-1-2","type":"branch","text":"病因病机","children":[{"id":"1-3-1-2-1","type":"leaf","title":"病因"},{"id":"1-3-1-2-2","type":"leaf","title":"病机"}]},{"id":"1-3-1-3","type":"branch","text":"诊断与鉴别诊断","children":[{"id":"1-3-1-3-1","type":"leaf","title":"诊断依据"},{"id":"1-3-1-3-2","type":"leaf","title":"鉴别诊断"}]},{"id":"1-3-1-4","type":"branch","text":"辨证论治","children":[{"id":"1-3-1-4-1","type":"branch","text":"辨证要点","children":[]},{"id":"1-3-1-4-2","type":"branch","text":"治疗原则","children":[]},{"id":"1-3-1-4-3","type":"branch","text":"证治分类","children":[{"id":"1-3-1-4-3-1","type":"branch","text":"风寒湿痹","children":[{"id":"1-3-1-4-3-1-1","type":"leaf","title":"行痹"},{"id":"1-3-1-4-3-1-2","type":"leaf","title":"痛痹"},{"id":"1-3-1-4-3-1-3","type":"leaf","title":"着痹"}]},{"id":"1-3-1-4-3-2","type":"branch","text":"风湿热痹","children":[]},{"id":"1-3-1-4-3-3","type":"branch","text":"痰瘀痹阻证","children":[]},{"id":"1-3-1-4-3-4","type":"branch","text":"寒热错杂证","children":[]},{"id":"1-3-1-4-3-5","type":"branch","text":"气血虚痹证","children":[]},{"id":"1-3-1-4-3-6","type":"branch","text":"肝肾虚痹证","children":[]}]}]},{"id":"1-3-1-5","type":"branch","text":"转归预后","children":[]},{"id":"1-3-1-6","type":"branch","text":"预防调护","children":[]}]},{"id":"1-3-2","type":"branch","text":"痿证","children":[{"id":"1-3-2-1","type":"branch","text":"概述","children":[]},{"id":"1-3-2-2","type":"branch","text":"病因病机","children":[{"id":"1-3-2-2-1","type":"leaf","title":"病因"},{"id":"1-3-2-2-2","type":"leaf","title":"病机"}]},{"id":"1-3-2-3","type":"branch","text":"诊断与鉴别诊断","children":[{"id":"1-3-2-3-1","type":"leaf","title":"诊断依据"},{"id":"1-3-2-3-2","type":"leaf","title":"鉴别诊断"}]},{"id":"1-3-2-4","type":"branch","text":"辨证论治","children":[{"id":"1-3-2-4-1","type":"leaf","title":"辨脏腑病位"},{"id":"1-3-2-4-2","type":"leaf","title":"治则治法"}]}]},{"id":"1-3-3","type":"branch","text":"颤证","children":[{"id":"1-3-3-1","type":"branch","text":"概述","children":[]},{"id":"1-3-3-2","type":"branch","text":"病因病机","children":[{"id":"1-3-3-2-1","type":"leaf","title":"病因"},{"id":"1-3-3-2-2","type":"leaf","title":"病机"}]},{"id":"1-3-3-3","type":"branch","text":"诊断与鉴别诊断","children":[{"id":"1-3-3-3-1","type":"leaf","title":"诊断依据"},{"id":"1-3-3-3-2","type":"leaf","title":"鉴别诊断"}]},{"id":"1-3-3-4","type":"branch","text":"辨证论治","children":[{"id":"1-3-3-4-1","type":"branch","text":"辨证要点","children":[]},{"id":"1-3-3-4-2","type":"branch","text":"治疗原则","children":[]},{"id":"1-3-3-4-3","type":"branch","text":"证治分类","children":[{"id":"1-3-3-4-3-1","type":"leaf","title":"风阳内动证"},{"id":"1-3-3-4-3-2","type":"leaf","title":"痰热风动证"},{"id":"1-3-3-4-3-3","type":"leaf","title":"气血亏虚证"},{"id":"1-3-3-4-3-4","type":"leaf","title":"髓海不足证"},{"id":"1-3-3-4-3-5","type":"leaf","title":"阳气虚衰证"}]}]}]},{"id":"1-3-4","type":"branch","text":"腰痛","children":[{"id":"1-3-4-1","type":"branch","text":"概述","children":[]},{"id":"1-3-4-2","type":"branch","text":"病因病机","children":[{"id":"1-3-4-2-1","type":"leaf","title":"病因"},{"id":"1-3-4-2-2","type":"leaf","title":"病机"}]},{"id":"1-3-4-3","type":"branch","text":"诊断与鉴别诊断","children":[{"id":"1-3-4-3-1","type":"leaf","title":"诊断依据"},{"id":"1-3-4-3-2","type":"leaf","title":"鉴别诊断"}]},{"id":"1-3-4-4","type":"branch","text":"辨证论治","children":[{"id":"1-3-4-4-1","type":"branch","text":"辨证要点","children":[]},{"id":"1-3-4-4-2","type":"branch","text":"治疗原则","children":[]},{"id":"1-3-4-4-3","type":"branch","text":"证治分类","children":[{"id":"1-3-4-4-3-1","type":"branch","text":"寒湿腰痛","children":[]},{"id":"1-3-4-4-3-2","type":"branch","text":"湿热腰痛","children":[]},{"id":"1-3-4-4-3-3","type":"branch","text":"瘀血腰痛","children":[]},{"id":"1-3-4-4-3-4","type":"branch","text":"肾虚腰痛","children":[{"id":"1-3-4-4-3-4-1","type":"leaf","title":"肾阴虚"},{"id":"1-3-4-4-3-4-2","type":"leaf","title":"肾阳虚"}]}]}]}]}]},{"id":"1-4","type":"branch","text":"肺系病证","children":[{"id":"1-4-1","type":"branch","text":"感冒","children":[{"id":"1-4-1-1","type":"branch","text":"概述","children":[]},{"id":"1-4-1-2","type":"branch","text":"病因病机","children":[{"id":"1-4-1-2-1","type":"leaf","title":"病因"},{"id":"1-4-1-2-2","type":"leaf","title":"病机"}]},{"id":"1-4-1-3","type":"branch","text":"诊断与鉴别诊断","children":[{"id":"1-4-1-3-1","type":"leaf","title":"诊断依据"},{"id":"1-4-1-3-2","type":"leaf","title":"鉴别诊断"}]},{"id":"1-4-1-4","type":"branch","text":"辨证论治","children":[{"id":"1-4-1-4-1","type":"branch","text":"辨证要点","children":[]},{"id":"1-4-1-4-2","type":"branch","text":"治疗原则","children":[]},{"id":"1-4-1-4-3","type":"branch","text":"证治分类","children":[{"id":"1-4-1-4-3-1","type":"branch","text":"常人感冒","children":[{"id":"1-4-1-4-3-1-1","type":"leaf","title":"风寒束表证"},{"id":"1-4-1-4-3-1-2","type":"leaf","title":"风热犯表证"},{"id":"1-4-1-4-3-1-3","type":"leaf","title":"暑湿伤表证"}]},{"id":"1-4-1-4-3-2","type":"branch","text":"虚体感冒","children":[{"id":"1-4-1-4-3-2-1","type":"leaf","title":"气虚感冒"},{"id":"1-4-1-4-3-2-2","type":"leaf","title":"阴虚感冒"}]}]}]},{"id":"1-4-1-5","type":"branch","text":"转归预后","children":[]},{"id":"1-4-1-6","type":"branch","text":"预防调护","children":[]}]},{"id":"1-4-2","type":"branch","text":"咳嗽","children":[{"id":"1-4-2-1","type":"branch","text":"概述","children":[]},{"id":"1-4-2-2","type":"branch","text":"病因病机","children":[{"id":"1-4-2-2-1","type":"leaf","title":"病因"},{"id":"1-4-2-2-2","type":"leaf","title":"病机"}]},{"id":"1-4-2-3","type":"branch","text":"诊断与鉴别诊断","children":[{"id":"1-4-2-3-1","type":"leaf","title":"诊断依据"},{"id":"1-4-2-3-2","type":"leaf","title":"鉴别诊断"}]},{"id":"1-4-2-4","type":"branch","text":"辨证论治","children":[{"id":"1-4-2-4-1","type":"branch","text":"辨证要点","children":[]},{"id":"1-4-2-4-2","type":"branch","text":"治疗原则","children":[]},{"id":"1-4-2-4-3","type":"branch","text":"证治分类","children":[{"id":"1-4-2-4-3-1","type":"branch","text":"外感咳嗽","children":[{"id":"1-4-2-4-3-1-1","type":"leaf","title":"风寒袭肺证"},{"id":"1-4-2-4-3-1-2","type":"leaf","title":"风热犯肺证"},{"id":"1-4-2-4-3-1-3","type":"leaf","title":"风燥伤肺证"}]},{"id":"1-4-2-4-3-2","type":"branch","text":"内伤咳嗽","children":[{"id":"1-4-2-4-3-2-1","type":"leaf","title":"痰湿蕴肺证"},{"id":"1-4-2-4-3-2-2","type":"leaf","title":"痰热郁肺证"},{"id":"1-4-2-4-3-2-3","type":"leaf","title":"肝火犯肺证"},{"id":"1-4-2-4-3-2-4","type":"leaf","title":"肺阴亏耗证"}]}]}]},{"id":"1-4-2-5","type":"branch","text":"转归预后","children":[]},{"id":"1-4-2-6","type":"branch","text":"预防调护","children":[]}]},{"id":"1-4-3","type":"branch","text":"哮病","children":[{"id":"1-4-3-1","type":"branch","text":"概述","children":[]},{"id":"1-4-3-2","type":"branch","text":"病因病机","children":[{"id":"1-4-3-2-1","type":"leaf","title":"病因"},{"id":"1-4-3-2-2","type":"leaf","title":"病机"}]},{"id":"1-4-3-3","type":"branch","text":"诊断与鉴别诊断","children":[{"id":"1-4-3-3-1","type":"leaf","title":"诊断依据"},{"id":"1-4-3-3-2","type":"leaf","title":"鉴别诊断"}]},{"id":"1-4-3-4","type":"branch","text":"辨证论治","children":[{"id":"1-4-3-4-1","type":"branch","text":"辨证要点","children":[]},{"id":"1-4-3-4-2","type":"branch","text":"治疗原则","children":[]},{"id":"1-4-3-4-3","type":"branch","text":"证治分类","children":[{"id":"1-4-3-4-3-1","type":"branch","text":"发作期","children":[{"id":"1-4-3-4-3-1-1","type":"leaf","title":"冷哮证"},{"id":"1-4-3-4-3-1-2","type":"leaf","title":"热哮证"},{"id":"1-4-3-4-3-1-3","type":"leaf","title":"寒包热哮证"},{"id":"1-4-3-4-3-1-4","type":"leaf","title":"风痰哮证"},{"id":"1-4-3-4-3-1-5","type":"leaf","title":"虚哮证"}]},{"id":"1-4-3-4-3-2","type":"branch","text":"缓解期","children":[{"id":"1-4-3-4-3-2-1","type":"leaf","title":"肺虚"},{"id":"1-4-3-4-3-2-2","type":"leaf","title":"脾虚"},{"id":"1-4-3-4-3-2-3","type":"leaf","title":"肾虚"}]}]}]},{"id":"1-4-3-5","type":"branch","text":"转归预后","children":[]},{"id":"1-4-3-6","type":"branch","text":"预防调护","children":[]}]},{"id":"1-4-4","type":"branch","text":"喘证","children":[{"id":"1-4-4-1","type":"branch","text":"概述","children":[]},{"id":"1-4-4-2","type":"branch","text":"病因病机","children":[{"id":"1-4-4-2-1","type":"leaf","title":"病因"},{"id":"1-4-4-2-2","type":"leaf","title":"病机"}]},{"id":"1-4-4-3","type":"branch","text":"诊断与鉴别诊断","children":[{"id":"1-4-4-3-1","type":"leaf","title":"诊断依据"},{"id":"1-4-4-3-2","type":"leaf","title":"鉴别诊断"}]},{"id":"1-4-4-4","type":"branch","text":"辨证论治","children":[{"id":"1-4-4-4-1","type":"branch","text":"辨证要点","children":[]},{"id":"1-4-4-4-2","type":"branch","text":"治疗原则","children":[]},{"id":"1-4-4-4-3","type":"branch","text":"证治分类","children":[{"id":"1-4-4-4-3-1","type":"branch","text":"实喘","children":[{"id":"1-4-4-4-3-1-1","type":"leaf","title":"风寒壅肺证"},{"id":"1-4-4-4-3-1-2","type":"leaf","title":"表寒肺热证"},{"id":"1-4-4-4-3-1-3","type":"leaf","title":"痰热郁肺证"},{"id":"1-4-4-4-3-1-4","type":"leaf","title":"痰浊阻肺证"},{"id":"1-4-4-4-3-1-5","type":"leaf","title":"肺气郁痹证"}]},{"id":"1-4-4-4-3-2","type":"branch","text":"虚喘","children":[{"id":"1-4-4-4-3-2-1","type":"leaf","title":"肺气虚耗证"},{"id":"1-4-4-4-3-2-2","type":"leaf","title":"肾虚不纳证"},{"id":"1-4-4-4-3-2-3","type":"leaf","title":"正虚喘脱证"}]}]}]},{"id":"1-4-4-5","type":"branch","text":"转归预后","children":[]},{"id":"1-4-4-6","type":"branch","text":"预防调护","children":[]}]},{"id":"1-4-5","type":"branch","text":"肺痈","children":[{"id":"1-4-5-1","type":"branch","text":"概述","children":[]},{"id":"1-4-5-2","type":"branch","text":"病因病机","children":[{"id":"1-4-5-2-1","type":"leaf","title":"病因"},{"id":"1-4-5-2-2","type":"leaf","title":"病机"}]},{"id":"1-4-5-3","type":"branch","text":"诊断与鉴别诊断","children":[{"id":"1-4-5-3-1","type":"leaf","title":"诊断依据"},{"id":"1-4-5-3-2","type":"leaf","title":"鉴别诊断"}]},{"id":"1-4-5-4","type":"branch","text":"辨证论治","children":[{"id":"1-4-5-4-1","type":"branch","text":"辨证要点","children":[]},{"id":"1-4-5-4-2","type":"branch","text":"治疗原则","children":[]},{"id":"1-4-5-4-3","type":"branch","text":"证治分类","children":[{"id":"1-4-5-4-3-1","type":"leaf","title":"初期"},{"id":"1-4-5-4-3-2","type":"leaf","title":"成痈期"},{"id":"1-4-5-4-3-3","type":"leaf","title":"溃脓期"},{"id":"1-4-5-4-3-4","type":"leaf","title":"恢复期"}]}]},{"id":"1-4-5-5","type":"branch","text":"转归预后","children":[]}]},{"id":"1-4-6","type":"branch","text":"肺痨","children":[{"id":"1-4-6-1","type":"branch","text":"概述","children":[]},{"id":"1-4-6-2","type":"branch","text":"病因病机","children":[{"id":"1-4-6-2-1","type":"leaf","title":"病因"},{"id":"1-4-6-2-2","type":"leaf","title":"病机"}]},{"id":"1-4-6-3","type":"branch","text":"诊断与鉴别诊断","children":[{"id":"1-4-6-3-1","type":"leaf","title":"诊断依据"},{"id":"1-4-6-3-2","type":"leaf","title":"鉴别诊断"}]},{"id":"1-4-6-4","type":"branch","text":"辨证论治","children":[{"id":"1-4-6-4-1","type":"branch","text":"辨证要点","children":[]},{"id":"1-4-6-4-2","type":"branch","text":"治疗原则","children":[]},{"id":"1-4-6-4-3","type":"branch","text":"证治分类","children":[{"id":"1-4-6-4-3-1","type":"leaf","title":"肺阴亏损证"},{"id":"1-4-6-4-3-2","type":"leaf","title":"虚火灼肺证"},{"id":"1-4-6-4-3-3","type":"leaf","title":"气阴耗伤证"},{"id":"1-4-6-4-3-4","type":"leaf","title":"阴阳两虚证"}]}]},{"id":"1-4-6-5","type":"branch","text":"预防调护","children":[]}]},{"id":"1-4-7","type":"branch","text":"肺胀","children":[{"id":"1-4-7-1","type":"branch","text":"概述","children":[]},{"id":"1-4-7-2","type":"branch","text":"病因病机","children":[{"id":"1-4-7-2-1","type":"leaf","title":"病因"},{"id":"1-4-7-2-2","type":"leaf","title":"病机"}]},{"id":"1-4-7-3","type":"branch","text":"诊断与鉴别诊断","children":[{"id":"1-4-7-3-1","type":"leaf","title":"诊断依据"},{"id":"1-4-7-3-2","type":"leaf","title":"鉴别诊断"}]},{"id":"1-4-7-4","type":"branch","text":"辨证论治","children":[{"id":"1-4-7-4-1","type":"branch","text":"辨证要点","children":[]},{"id":"1-4-7-4-2","type":"branch","text":"治疗原则","children":[]},{"id":"1-4-7-4-3","type":"branch","text":"证治分类","children":[{"id":"1-4-7-4-3-1","type":"leaf","title":"外寒里饮证"},{"id":"1-4-7-4-3-2","type":"leaf","title":"痰浊壅肺证"},{"id":"1-4-7-4-3-3","type":"leaf","title":"痰热郁肺证"},{"id":"1-4-7-4-3-4","type":"leaf","title":"痰蒙神窍证"},{"id":"1-4-7-4-3-5","type":"leaf","title":"痰瘀阻肺证"},{"id":"1-4-7-4-3-6","type":"leaf","title":"阳虚水泛证"},{"id":"1-4-7-4-3-7","type":"leaf","title":"肺肾气虚证"}]}]}]}]},{"id":"1-5","type":"branch","text":"肺系病证","children":[{"id":"1-5-1","type":"branch","text":"感冒","children":[{"id":"1-5-1-1","type":"branch","text":"概述","children":[]},{"id":"1-5-1-2","type":"branch","text":"病因病机","children":[{"id":"1-5-1-2-1","type":"leaf","title":"病因"},{"id":"1-5-1-2-2","type":"leaf","title":"病机"}]},{"id":"1-5-1-3","type":"branch","text":"诊断与鉴别诊断","children":[{"id":"1-5-1-3-1","type":"leaf","title":"诊断依据"},{"id":"1-5-1-3-2","type":"leaf","title":"鉴别诊断"}]},{"id":"1-5-1-4","type":"branch","text":"辨证论治","children":[{"id":"1-5-1-4-1","type":"branch","text":"辨证要点","children":[]},{"id":"1-5-1-4-2","type":"branch","text":"治疗原则","children":[]},{"id":"1-5-1-4-3","type":"branch","text":"证治分类","children":[{"id":"1-5-1-4-3-1","type":"branch","text":"常人感冒","children":[{"id":"1-5-1-4-3-1-1","type":"leaf","title":"风寒束表证"},{"id":"1-5-1-4-3-1-2","type":"leaf","title":"风热犯表证"},{"id":"1-5-1-4-3-1-3","type":"leaf","title":"暑湿伤表证"}]},{"id":"1-5-1-4-3-2","type":"branch","text":"虚体感冒","children":[{"id":"1-5-1-4-3-2-1","type":"leaf","title":"气虚感冒"},{"id":"1-5-1-4-3-2-2","type":"leaf","title":"阴虚感冒"}]}]}]},{"id":"1-5-1-5","type":"branch","text":"转归预后","children":[]},{"id":"1-5-1-6","type":"branch","text":"预防调护","children":[]}]},{"id":"1-5-2","type":"branch","text":"咳嗽","children":[{"id":"1-5-2-1","type":"branch","text":"概述","children":[]},{"id":"1-5-2-2","type":"branch","text":"病因病机","children":[{"id":"1-5-2-2-1","type":"leaf","title":"病因"},{"id":"1-5-2-2-2","type":"leaf","title":"病机"}]},{"id":"1-5-2-3","type":"branch","text":"诊断与鉴别诊断","children":[{"id":"1-5-2-3-1","type":"leaf","title":"诊断依据"},{"id":"1-5-2-3-2","type":"leaf","title":"鉴别诊断"}]},{"id":"1-5-2-4","type":"branch","text":"辨证论治","children":[{"id":"1-5-2-4-1","type":"branch","text":"辨证要点","children":[]},{"id":"1-5-2-4-2","type":"branch","text":"治疗原则","children":[]},{"id":"1-5-2-4-3","type":"branch","text":"证治分类","children":[{"id":"1-5-2-4-3-1","type":"branch","text":"外感咳嗽","children":[{"id":"1-5-2-4-3-1-1","type":"leaf","title":"风寒袭肺证"},{"id":"1-5-2-4-3-1-2","type":"leaf","title":"风热犯肺证"},{"id":"1-5-2-4-3-1-3","type":"leaf","title":"风燥伤肺证"}]},{"id":"1-5-2-4-3-2","type":"branch","text":"内伤咳嗽","children":[{"id":"1-5-2-4-3-2-1","type":"leaf","title":"痰湿蕴肺证"},{"id":"1-5-2-4-3-2-2","type":"leaf","title":"痰热郁肺证"},{"id":"1-5-2-4-3-2-3","type":"leaf","title":"肝火犯肺证"},{"id":"1-5-2-4-3-2-4","type":"leaf","title":"肺阴亏耗证"}]}]}]},{"id":"1-5-2-5","type":"branch","text":"转归预后","children":[]},{"id":"1-5-2-6","type":"branch","text":"预防调护","children":[]}]},{"id":"1-5-3","type":"branch","text":"哮病","children":[{"id":"1-5-3-1","type":"branch","text":"概述","children":[]},{"id":"1-5-3-2","type":"branch","text":"病因病机","children":[{"id":"1-5-3-2-1","type":"leaf","title":"病因"},{"id":"1-5-3-2-2","type":"leaf","title":"病机"}]},{"id":"1-5-3-3","type":"branch","text":"诊断与鉴别诊断","children":[{"id":"1-5-3-3-1","type":"leaf","title":"诊断依据"},{"id":"1-5-3-3-2","type":"leaf","title":"鉴别诊断"}]},{"id":"1-5-3-4","type":"branch","text":"辨证论治","children":[{"id":"1-5-3-4-1","type":"branch","text":"辨证要点","children":[]},{"id":"1-5-3-4-2","type":"branch","text":"治疗原则","children":[]},{"id":"1-5-3-4-3","type":"branch","text":"证治分类","children":[{"id":"1-5-3-4-3-1","type":"branch","text":"发作期","children":[{"id":"1-5-3-4-3-1-1","type":"leaf","title":"冷哮证"},{"id":"1-5-3-4-3-1-2","type":"leaf","title":"热哮证"},{"id":"1-5-3-4-3-1-3","type":"leaf","title":"寒包热哮证"},{"id":"1-5-3-4-3-1-4","type":"leaf","title":"风痰哮证"},{"id":"1-5-3-4-3-1-5","type":"leaf","title":"虚哮证"}]},{"id":"1-5-3-4-3-2","type":"branch","text":"缓解期","children":[{"id":"1-5-3-4-3-2-1","type":"leaf","title":"肺虚"},{"id":"1-5-3-4-3-2-2","type":"leaf","title":"脾虚"},{"id":"1-5-3-4-3-2-3","type":"leaf","title":"肾虚"}]}]}]},{"id":"1-5-3-5","type":"branch","text":"转归预后","children":[]},{"id":"1-5-3-6","type":"branch","text":"预防调护","children":[]}]},{"id":"1-5-4","type":"branch","text":"喘证","children":[{"id":"1-5-4-1","type":"branch","text":"概述","children":[]},{"id":"1-5-4-2","type":"branch","text":"病因病机","children":[{"id":"1-5-4-2-1","type":"leaf","title":"病因"},{"id":"1-5-4-2-2","type":"leaf","title":"病机"}]},{"id":"1-5-4-3","type":"branch","text":"诊断与鉴别诊断","children":[{"id":"1-5-4-3-1","type":"leaf","title":"诊断依据"},{"id":"1-5-4-3-2","type":"leaf","title":"鉴别诊断"}]},{"id":"1-5-4-4","type":"branch","text":"辨证论治","children":[{"id":"1-5-4-4-1","type":"branch","text":"辨证要点","children":[]},{"id":"1-5-4-4-2","type":"branch","text":"治疗原则","children":[]},{"id":"1-5-4-4-3","type":"branch","text":"证治分类","children":[{"id":"1-5-4-4-3-1","type":"branch","text":"实喘","children":[{"id":"1-5-4-4-3-1-1","type":"leaf","title":"风寒壅肺证"},{"id":"1-5-4-4-3-1-2","type":"leaf","title":"表寒肺热证"},{"id":"1-5-4-4-3-1-3","type":"leaf","title":"痰热郁肺证"},{"id":"1-5-4-4-3-1-4","type":"leaf","title":"痰浊阻肺证"},{"id":"1-5-4-4-3-1-5","type":"leaf","title":"肺气郁痹证"}]},{"id":"1-5-4-4-3-2","type":"branch","text":"虚喘","children":[{"id":"1-5-4-4-3-2-1","type":"leaf","title":"肺气虚耗证"},{"id":"1-5-4-4-3-2-2","type":"leaf","title":"肾虚不纳证"},{"id":"1-5-4-4-3-2-3","type":"leaf","title":"正虚喘脱证"}]}]}]},{"id":"1-5-4-5","type":"branch","text":"转归预后","children":[]},{"id":"1-5-4-6","type":"branch","text":"预防调护","children":[]}]},{"id":"1-5-5","type":"branch","text":"肺痈","children":[{"id":"1-5-5-1","type":"branch","text":"概述","children":[]},{"id":"1-5-5-2","type":"branch","text":"病因病机","children":[{"id":"1-5-5-2-1","type":"leaf","title":"病因"},{"id":"1-5-5-2-2","type":"leaf","title":"病机"}]},{"id":"1-5-5-3","type":"branch","text":"诊断与鉴别诊断","children":[{"id":"1-5-5-3-1","type":"leaf","title":"诊断依据"},{"id":"1-5-5-3-2","type":"leaf","title":"鉴别诊断"}]},{"id":"1-5-5-4","type":"branch","text":"辨证论治","children":[{"id":"1-5-5-4-1","type":"branch","text":"辨证要点","children":[]},{"id":"1-5-5-4-2","type":"branch","text":"治疗原则","children":[]},{"id":"1-5-5-4-3","type":"branch","text":"证治分类","children":[{"id":"1-5-5-4-3-1","type":"leaf","title":"初期"},{"id":"1-5-5-4-3-2","type":"leaf","title":"成痈期"},{"id":"1-5-5-4-3-3","type":"leaf","title":"溃脓期"},{"id":"1-5-5-4-3-4","type":"leaf","title":"恢复期"}]}]},{"id":"1-5-5-5","type":"branch","text":"转归预后","children":[]}]},{"id":"1-5-6","type":"branch","text":"肺痨","children":[{"id":"1-5-6-1","type":"branch","text":"概述","children":[]},{"id":"1-5-6-2","type":"branch","text":"病因病机","children":[{"id":"1-5-6-2-1","type":"leaf","title":"病因"},{"id":"1-5-6-2-2","type":"leaf","title":"病机"}]},{"id":"1-5-6-3","type":"branch","text":"诊断与鉴别诊断","children":[{"id":"1-5-6-3-1","type":"leaf","title":"诊断依据"},{"id":"1-5-6-3-2","type":"leaf","title":"鉴别诊断"}]},{"id":"1-5-6-4","type":"branch","text":"辨证论治","children":[{"id":"1-5-6-4-1","type":"branch","text":"辨证要点","children":[]},{"id":"1-5-6-4-2","type":"branch","text":"治疗原则","children":[]},{"id":"1-5-6-4-3","type":"branch","text":"证治分类","children":[{"id":"1-5-6-4-3-1","type":"leaf","title":"肺阴亏损证"},{"id":"1-5-6-4-3-2","type":"leaf","title":"虚火灼肺证"},{"id":"1-5-6-4-3-3","type":"leaf","title":"气阴耗伤证"},{"id":"1-5-6-4-3-4","type":"leaf","title":"阴阳两虚证"}]}]},{"id":"1-5-6-5","type":"branch","text":"预防调护","children":[]}]},{"id":"1-5-7","type":"branch","text":"肺胀","children":[{"id":"1-5-7-1","type":"branch","text":"概述","children":[]},{"id":"1-5-7-2","type":"branch","text":"病因病机","children":[{"id":"1-5-7-2-1","type":"leaf","title":"病因"},{"id":"1-5-7-2-2","type":"leaf","title":"病机"}]},{"id":"1-5-7-3","type":"branch","text":"诊断与鉴别诊断","children":[{"id":"1-5-7-3-1","type":"leaf","title":"诊断依据"},{"id":"1-5-7-3-2","type":"leaf","title":"鉴别诊断"}]},{"id":"1-5-7-4","type":"branch","text":"辨证论治","children":[{"id":"1-5-7-4-1","type":"branch","text":"辨证要点","children":[]},{"id":"1-5-7-4-2","type":"branch","text":"治疗原则","children":[]},{"id":"1-5-7-4-3","type":"branch","text":"证治分类","children":[{"id":"1-5-7-4-3-1","type":"leaf","title":"外寒里饮证"},{"id":"1-5-7-4-3-2","type":"leaf","title":"痰浊壅肺证"},{"id":"1-5-7-4-3-3","type":"leaf","title":"痰热郁肺证"},{"id":"1-5-7-4-3-4","type":"leaf","title":"痰蒙神窍证"},{"id":"1-5-7-4-3-5","type":"leaf","title":"痰瘀阻肺证"},{"id":"1-5-7-4-3-6","type":"leaf","title":"阳虚水泛证"},{"id":"1-5-7-4-3-7","type":"leaf","title":"肺肾气虚证"}]}]}]}]},{"id":"1-6","type":"branch","text":"肾系病证","children":[{"id":"1-6-1","type":"branch","text":"水肿","children":[{"id":"1-6-1-1","type":"branch","text":"概述","children":[]},{"id":"1-6-1-2","type":"branch","text":"病因病机","children":[{"id":"1-6-1-2-1","type":"leaf","title":"病因"},{"id":"1-6-1-2-2","type":"leaf","title":"病机"}]},{"id":"1-6-1-3","type":"branch","text":"诊断与鉴别诊断","children":[{"id":"1-6-1-3-1","type":"leaf","title":"诊断依据"},{"id":"1-6-1-3-2","type":"leaf","title":"鉴别诊断"}]},{"id":"1-6-1-4","type":"branch","text":"辨证论治","children":[{"id":"1-6-1-4-1","type":"branch","text":"辨证要点","children":[]},{"id":"1-6-1-4-2","type":"branch","text":"治疗原则","children":[]},{"id":"1-6-1-4-3","type":"branch","text":"证治分类","children":[{"id":"1-6-1-4-3-1","type":"branch","text":"阳水","children":[{"id":"1-6-1-4-3-1-1","type":"leaf","title":"风水相搏证"},{"id":"1-6-1-4-3-1-2","type":"leaf","title":"湿毒浸淫证"},{"id":"1-6-1-4-3-1-3","type":"leaf","title":"水湿浸渍证"},{"id":"1-6-1-4-3-1-4","type":"leaf","title":"湿热壅盛证"}]},{"id":"1-6-1-4-3-2","type":"branch","text":"阴水","children":[{"id":"1-6-1-4-3-2-1","type":"leaf","title":"脾阳亏虚证"},{"id":"1-6-1-4-3-2-2","type":"leaf","title":"肾阳衰微证"},{"id":"1-6-1-4-3-2-3","type":"leaf","title":"瘀水互结证"}]}]}]},{"id":"1-6-1-5","type":"branch","text":"转归预后","children":[]},{"id":"1-6-1-6","type":"branch","text":"预防调护","children":[]}]},{"id":"1-6-2","type":"branch","text":"淋证","children":[{"id":"1-6-2-1","type":"branch","text":"概述","children":[]},{"id":"1-6-2-2","type":"branch","text":"病因病机","children":[{"id":"1-6-2-2-1","type":"leaf","title":"病因"},{"id":"1-6-2-2-2","type":"leaf","title":"病机"}]},{"id":"1-6-2-3","type":"branch","text":"诊断与鉴别诊断","children":[{"id":"1-6-2-3-1","type":"leaf","title":"诊断依据"},{"id":"1-6-2-3-2","type":"leaf","title":"鉴别诊断"}]},{"id":"1-6-2-4","type":"branch","text":"辨证论治","children":[{"id":"1-6-2-4-1","type":"branch","text":"辨证要点","children":[]},{"id":"1-6-2-4-2","type":"branch","text":"治疗原则","children":[]},{"id":"1-6-2-4-3","type":"branch","text":"证治分类","children":[{"id":"1-6-2-4-3-1","type":"leaf","title":"热淋"},{"id":"1-6-2-4-3-2","type":"leaf","title":"石淋"},{"id":"1-6-2-4-3-3","type":"leaf","title":"血淋"},{"id":"1-6-2-4-3-4","type":"leaf","title":"气淋"},{"id":"1-6-2-4-3-5","type":"leaf","title":"膏淋"},{"id":"1-6-2-4-3-6","type":"leaf","title":"劳淋"}]}]},{"id":"1-6-2-5","type":"branch","text":"转归预后","children":[]},{"id":"1-6-2-6","type":"branch","text":"预防调护","children":[]}]},{"id":"1-6-3","type":"branch","text":"癃闭","children":[{"id":"1-6-3-1","type":"branch","text":"概述","children":[]},{"id":"1-6-3-2","type":"branch","text":"病因病机","children":[{"id":"1-6-3-2-1","type":"leaf","title":"病因"},{"id":"1-6-3-2-2","type":"leaf","title":"病机"}]},{"id":"1-6-3-3","type":"branch","text":"诊断","children":[]},{"id":"1-6-3-4","type":"branch","text":"辨证论治","children":[{"id":"1-6-3-4-1","type":"branch","text":"辨证要点","children":[]},{"id":"1-6-3-4-2","type":"branch","text":"治疗原则","children":[]},{"id":"1-6-3-4-3","type":"branch","text":"证治分类","children":[{"id":"1-6-3-4-3-1","type":"leaf","title":"膀胱湿热证"},{"id":"1-6-3-4-3-2","type":"leaf","title":"肺热壅盛证"},{"id":"1-6-3-4-3-3","type":"leaf","title":"肝郁气滞证"},{"id":"1-6-3-4-3-4","type":"leaf","title":"浊瘀阻塞证"},{"id":"1-6-3-4-3-5","type":"leaf","title":"脾气不升证"},{"id":"1-6-3-4-3-6","type":"leaf","title":"肾阳衰惫证"}]}]},{"id":"1-6-3-5","type":"branch","text":"常用外治法","children":[]},{"id":"1-6-3-6","type":"branch","text":"转归预后","children":[]}]}]},{"id":"1-7","type":"branch","text":"肝胆病证","children":[{"id":"1-7-1","type":"branch","text":"胁痛","children":[{"id":"1-7-1-1","type":"branch","text":"概述","children":[]},{"id":"1-7-1-2","type":"branch","text":"病因病机","children":[{"id":"1-7-1-2-1","type":"leaf","title":"病因"},{"id":"1-7-1-2-2","type":"leaf","title":"病机"}]},{"id":"1-7-1-3","type":"branch","text":"诊断与鉴别诊断","children":[{"id":"1-7-1-3-1","type":"leaf","title":"诊断要点"},{"id":"1-7-1-3-2","type":"leaf","title":"鉴别诊断"}]},{"id":"1-7-1-4","type":"branch","text":"辨证论治","children":[{"id":"1-7-1-4-1","type":"branch","text":"辨证要点","children":[]},{"id":"1-7-1-4-2","type":"branch","text":"治疗原则","children":[]},{"id":"1-7-1-4-3","type":"branch","text":"证治分类","children":[{"id":"1-7-1-4-3-1","type":"leaf","title":"肝郁气滞证"},{"id":"1-7-1-4-3-2","type":"leaf","title":"肝胆湿热证"},{"id":"1-7-1-4-3-3","type":"leaf","title":"瘀血阻络证"},{"id":"1-7-1-4-3-4","type":"leaf","title":"肝络失养证"}]}]},{"id":"1-7-1-5","type":"branch","text":"转归预后","children":[]}]},{"id":"1-7-2","type":"branch","text":"黄疸","children":[{"id":"1-7-2-1","type":"branch","text":"概述","children":[]},{"id":"1-7-2-2","type":"branch","text":"病因病机","children":[{"id":"1-7-2-2-1","type":"leaf","title":"病因"},{"id":"1-7-2-2-2","type":"leaf","title":"病机"}]},{"id":"1-7-2-3","type":"branch","text":"诊断与鉴别诊断","children":[{"id":"1-7-2-3-1","type":"leaf","title":"诊断依据"},{"id":"1-7-2-3-2","type":"leaf","title":"鉴别诊断"}]},{"id":"1-7-2-4","type":"branch","text":"辨证论治","children":[{"id":"1-7-2-4-1","type":"branch","text":"辨证要点","children":[]},{"id":"1-7-2-4-2","type":"branch","text":"治疗原则","children":[]},{"id":"1-7-2-4-3","type":"branch","text":"证治分类","children":[{"id":"1-7-2-4-3-1","type":"branch","text":"阳黄","children":[{"id":"1-7-2-4-3-1-1","type":"leaf","title":"热重于湿证"},{"id":"1-7-2-4-3-1-2","type":"leaf","title":"湿重于热证"},{"id":"1-7-2-4-3-1-3","type":"leaf","title":"胆腑郁热证"},{"id":"1-7-2-4-3-1-4","type":"leaf","title":"疫毒炽盛证(急黄)"}]},{"id":"1-7-2-4-3-2","type":"branch","text":"阴黄","children":[{"id":"1-7-2-4-3-2-1","type":"leaf","title":"寒湿阻遏证"},{"id":"1-7-2-4-3-2-2","type":"leaf","title":"脾虚湿滞证"}]},{"id":"1-7-2-4-3-3","type":"branch","text":"黄疸消退后的调治","children":[{"id":"1-7-2-4-3-3-1","type":"leaf","title":"湿热留恋证"},{"id":"1-7-2-4-3-3-2","type":"leaf","title":"肝脾不调证"},{"id":"1-7-2-4-3-3-3","type":"leaf","title":"气滞血瘀证"}]}]}]}]},{"id":"1-7-3","type":"branch","text":"积证","children":[{"id":"1-7-3-1","type":"branch","text":"概述","children":[]},{"id":"1-7-3-2","type":"branch","text":"病因病机","children":[{"id":"1-7-3-2-1","type":"leaf","title":"病因"},{"id":"1-7-3-2-2","type":"leaf","title":"病机"}]}]},{"id":"1-7-4","type":"branch","text":"聚证","children":[{"id":"1-7-4-1","type":"branch","text":"概述","children":[]},{"id":"1-7-4-2","type":"branch","text":"病因病机","children":[{"id":"1-7-4-2-1","type":"leaf","title":"病因"},{"id":"1-7-4-2-2","type":"leaf","title":"病机"}]}]}]},{"id":"1-8","type":"branch","text":"气血津液病证","children":[{"id":"1-8-1","type":"branch","text":"郁证","children":[{"id":"1-8-1-1","type":"branch","text":"概述","children":[]},{"id":"1-8-1-2","type":"branch","text":"病因病机","children":[{"id":"1-8-1-2-1","type":"leaf","title":"病因"},{"id":"1-8-1-2-2","type":"leaf","title":"病机"}]},{"id":"1-8-1-3","type":"branch","text":"诊断与鉴别诊断","children":[{"id":"1-8-1-3-1","type":"leaf","title":"诊断依据"},{"id":"1-8-1-3-2","type":"leaf","title":"鉴别诊断"}]},{"id":"1-8-1-4","type":"branch","text":"辨证论治","children":[{"id":"1-8-1-4-1","type":"branch","text":"辨证要点","children":[]},{"id":"1-8-1-4-2","type":"branch","text":"治疗原则","children":[]},{"id":"1-8-1-4-3","type":"branch","text":"证治分类","children":[{"id":"1-8-1-4-3-1","type":"leaf","title":"肝气郁结证"},{"id":"1-8-1-4-3-2","type":"leaf","title":"气郁化火证"},{"id":"1-8-1-4-3-3","type":"leaf","title":"痰气郁结证"},{"id":"1-8-1-4-3-4","type":"leaf","title":"心神失养证"},{"id":"1-8-1-4-3-5","type":"leaf","title":"心脾两虚证"},{"id":"1-8-1-4-3-6","type":"leaf","title":"心肾阴虚证"}]}]},{"id":"1-8-1-5","type":"branch","text":"预防调护","children":[]}]},{"id":"1-8-2","type":"branch","text":"血证","children":[{"id":"1-8-2-1","type":"branch","text":"概述","children":[]},{"id":"1-8-2-2","type":"branch","text":"病因病机","children":[{"id":"1-8-2-2-1","type":"leaf","title":"病因"},{"id":"1-8-2-2-2","type":"leaf","title":"病机"}]},{"id":"1-8-2-3","type":"branch","text":"诊断与鉴别诊断","children":[{"id":"1-8-2-3-1","type":"branch","text":"诊断依据","children":[{"id":"1-8-2-3-1-1","type":"leaf","title":"鼻衄"},{"id":"1-8-2-3-1-2","type":"leaf","title":"齿衄"},{"id":"1-8-2-3-1-3","type":"leaf","title":"咳血"},{"id":"1-8-2-3-1-4","type":"leaf","title":"吐血"},{"id":"1-8-2-3-1-5","type":"leaf","title":"便血"},{"id":"1-8-2-3-1-6","type":"leaf","title":"尿血"},{"id":"1-8-2-3-1-7","type":"leaf","title":"紫斑"}]},{"id":"1-8-2-3-2","type":"branch","text":"鉴别诊断","children":[{"id":"1-8-2-3-2-1","type":"leaf","title":"鼻衄"},{"id":"1-8-2-3-2-2","type":"leaf","title":"齿衄"},{"id":"1-8-2-3-2-3","type":"leaf","title":"咳血"},{"id":"1-8-2-3-2-4","type":"leaf","title":"吐血"},{"id":"1-8-2-3-2-5","type":"leaf","title":"便血"},{"id":"1-8-2-3-2-6","type":"leaf","title":"尿血"},{"id":"1-8-2-3-2-7","type":"leaf","title":"紫斑"}]}]},{"id":"1-8-2-4","type":"branch","text":"辨证论治","children":[{"id":"1-8-2-4-1","type":"branch","text":"辨证要点","children":[]},{"id":"1-8-2-4-2","type":"branch","text":"治疗原则","children":[]},{"id":"1-8-2-4-3","type":"branch","text":"证治分类","children":[{"id":"1-8-2-4-3-1","type":"branch","text":"鼻衄","children":[{"id":"1-8-2-4-3-1-1","type":"leaf","title":"热邪犯肺证"},{"id":"1-8-2-4-3-1-2","type":"leaf","title":"胃热炽盛证"},{"id":"1-8-2-4-3-1-3","type":"leaf","title":"肝火上炎证"},{"id":"1-8-2-4-3-1-4","type":"leaf","title":"气血亏虚证"}]},{"id":"1-8-2-4-3-2","type":"branch","text":"齿衄","children":[{"id":"1-8-2-4-3-2-1","type":"leaf","title":"胃火炽盛证"},{"id":"1-8-2-4-3-2-2","type":"leaf","title":"阴虚火旺证"}]},{"id":"1-8-2-4-3-3","type":"branch","text":"咳血","children":[{"id":"1-8-2-4-3-3-1","type":"leaf","title":"燥热伤肺证"},{"id":"1-8-2-4-3-3-2","type":"leaf","title":"肝火犯肺证"},{"id":"1-8-2-4-3-3-3","type":"leaf","title":"阴虚肺热证"}]},{"id":"1-8-2-4-3-4","type":"branch","text":"吐血","children":[{"id":"1-8-2-4-3-4-1","type":"leaf","title":"胃热壅盛证"},{"id":"1-8-2-4-3-4-2","type":"leaf","title":"肝火犯胃证"},{"id":"1-8-2-4-3-4-3","type":"leaf","title":"气虚血溢证"}]},{"id":"1-8-2-4-3-5","type":"branch","text":"便血","children":[{"id":"1-8-2-4-3-5-1","type":"leaf","title":"肠道湿热证"},{"id":"1-8-2-4-3-5-2","type":"leaf","title":"热灼胃络证"},{"id":"1-8-2-4-3-5-3","type":"leaf","title":"气虚不摄证"}]},{"id":"1-8-2-4-3-6","type":"branch","text":"尿血","children":[{"id":"1-8-2-4-3-6-1","type":"leaf","title":"下焦湿热证"},{"id":"1-8-2-4-3-6-2","type":"leaf","title":"肾虚火旺证"},{"id":"1-8-2-4-3-6-3","type":"leaf","title":"脾不统血证"},{"id":"1-8-2-4-3-6-4","type":"leaf","title":"肾气不固证"}]},{"id":"1-8-2-4-3-7","type":"branch","text":"紫斑","children":[{"id":"1-8-2-4-3-7-1","type":"leaf","title":"血热妄行证"},{"id":"1-8-2-4-3-7-2","type":"leaf","title":"阴虚火旺证"},{"id":"1-8-2-4-3-7-3","type":"leaf","title":"气不摄血证"}]}]}]},{"id":"1-8-2-5","type":"branch","text":"转归预后","children":[]},{"id":"1-8-2-6","type":"branch","text":"预防调护","children":[]}]},{"id":"1-8-3","type":"branch","text":"痰饮","children":[{"id":"1-8-3-1","type":"branch","text":"概述","children":[]},{"id":"1-8-3-2","type":"branch","text":"分类","children":[]},{"id":"1-8-3-3","type":"branch","text":"病因病机","children":[{"id":"1-8-3-3-1","type":"leaf","title":"病因"},{"id":"1-8-3-3-2","type":"leaf","title":"病机"}]},{"id":"1-8-3-4","type":"branch","text":"辨证论治","children":[{"id":"1-8-3-4-1","type":"branch","text":"辨证要点","children":[]},{"id":"1-8-3-4-2","type":"branch","text":"治疗原则","children":[]},{"id":"1-8-3-4-3","type":"branch","text":"证治分类","children":[{"id":"1-8-3-4-3-1","type":"branch","text":"痰饮","children":[{"id":"1-8-3-4-3-1-1","type":"leaf","title":"脾阳虚弱证"},{"id":"1-8-3-4-3-1-2","type":"leaf","title":"饮留胃肠证"}]},{"id":"1-8-3-4-3-2","type":"branch","text":"悬饮","children":[{"id":"1-8-3-4-3-2-1","type":"leaf","title":"邪犯胸肺证"},{"id":"1-8-3-4-3-2-2","type":"leaf","title":"饮停胸胁证"},{"id":"1-8-3-4-3-2-3","type":"leaf","title":"络气不和证"},{"id":"1-8-3-4-3-2-4","type":"leaf","title":"阴虚内热证"}]},{"id":"1-8-3-4-3-3","type":"branch","text":"溢饮","children":[{"id":"1-8-3-4-3-3-1","type":"leaf","title":"表寒里饮证"}]},{"id":"1-8-3-4-3-4","type":"branch","text":"支饮","children":[{"id":"1-8-3-4-3-4-1","type":"leaf","title":"寒饮伏肺证"},{"id":"1-8-3-4-3-4-2","type":"leaf","title":"脾肾阳虚证"}]}]}]}]},{"id":"1-8-4","type":"branch","text":"消渴","children":[{"id":"1-8-4-1","type":"branch","text":"概述","children":[]},{"id":"1-8-4-2","type":"branch","text":"病因病机","children":[{"id":"1-8-4-2-1","type":"leaf","title":"病因"},{"id":"1-8-4-2-2","type":"leaf","title":"病机"}]},{"id":"1-8-4-3","type":"branch","text":"诊断与鉴别诊断","children":[{"id":"1-8-4-3-1","type":"leaf","title":"诊断依据"},{"id":"1-8-4-3-2","type":"leaf","title":"鉴别诊断"}]},{"id":"1-8-4-4","type":"branch","text":"辨证论治","children":[{"id":"1-8-4-4-1","type":"branch","text":"辨证要点","children":[]},{"id":"1-8-4-4-2","type":"branch","text":"治疗原则","children":[]},{"id":"1-8-4-4-3","type":"branch","text":"证治分类","children":[{"id":"1-8-4-4-3-1","type":"branch","text":"上消","children":[{"id":"1-8-4-4-3-1-1","type":"leaf","title":"肺热津伤证"}]},{"id":"1-8-4-4-3-2","type":"branch","text":"中消","children":[{"id":"1-8-4-4-3-2-1","type":"leaf","title":"胃热炽盛证"},{"id":"1-8-4-4-3-2-2","type":"leaf","title":"气阴亏虚证"}]},{"id":"1-8-4-4-3-3","type":"branch","text":"下消","children":[{"id":"1-8-4-4-3-3-1","type":"leaf","title":"肾阴亏虚证"},{"id":"1-8-4-4-3-3-2","type":"leaf","title":"阴阳两虚证"}]}]}]},{"id":"1-8-4-5","type":"branch","text":"转归预后","children":[]},{"id":"1-8-4-6","type":"branch","text":"预防调护","children":[]}]},{"id":"1-8-5","type":"branch","text":"汗证","children":[{"id":"1-8-5-1","type":"branch","text":"概述","children":[]},{"id":"1-8-5-2","type":"branch","text":"病因病机","children":[{"id":"1-8-5-2-1","type":"leaf","title":"病因"},{"id":"1-8-5-2-2","type":"leaf","title":"病机"}]},{"id":"1-8-5-3","type":"branch","text":"诊断与鉴别诊断","children":[{"id":"1-8-5-3-1","type":"leaf","title":"诊断依据"},{"id":"1-8-5-3-2","type":"leaf","title":"鉴别诊断"}]},{"id":"1-8-5-4","type":"branch","text":"辨证论治","children":[{"id":"1-8-5-4-1","type":"branch","text":"辨证要点","children":[]},{"id":"1-8-5-4-2","type":"branch","text":"治疗原则","children":[]},{"id":"1-8-5-4-3","type":"branch","text":"证治分类","children":[{"id":"1-8-5-4-3-1","type":"leaf","title":"肺卫不固证"},{"id":"1-8-5-4-3-2","type":"leaf","title":"心血不足证"},{"id":"1-8-5-4-3-3","type":"leaf","title":"阴虚火旺证"},{"id":"1-8-5-4-3-4","type":"leaf","title":"邪热郁蒸证"}]}]}]},{"id":"1-8-6","type":"branch","text":"内伤发热","children":[{"id":"1-8-6-1","type":"branch","text":"概述","children":[]},{"id":"1-8-6-2","type":"branch","text":"病因病机","children":[{"id":"1-8-6-2-1","type":"leaf","title":"病因"},{"id":"1-8-6-2-2","type":"leaf","title":"病机"}]},{"id":"1-8-6-3","type":"branch","text":"诊断","children":[]},{"id":"1-8-6-4","type":"branch","text":"辨证论治","children":[{"id":"1-8-6-4-1","type":"branch","text":"辨证要点","children":[]},{"id":"1-8-6-4-2","type":"branch","text":"治疗原则","children":[]},{"id":"1-8-6-4-3","type":"branch","text":"证治分类","children":[{"id":"1-8-6-4-3-1","type":"leaf","title":"阴虚发热证"},{"id":"1-8-6-4-3-2","type":"leaf","title":"血虚发热证"},{"id":"1-8-6-4-3-3","type":"leaf","title":"气虚发热证"},{"id":"1-8-6-4-3-4","type":"leaf","title":"阳虚发热证"},{"id":"1-8-6-4-3-5","type":"leaf","title":"气郁发热证"},{"id":"1-8-6-4-3-6","type":"leaf","title":"痰湿郁热证"},{"id":"1-8-6-4-3-7","type":"leaf","title":"血瘀发热证"}]}]}]},{"id":"1-8-7","type":"branch","text":"虚劳","children":[{"id":"1-8-7-1","type":"branch","text":"概述","children":[]},{"id":"1-8-7-2","type":"branch","text":"病因病机","children":[{"id":"1-8-7-2-1","type":"leaf","title":"病因"},{"id":"1-8-7-2-2","type":"leaf","title":"病机"}]},{"id":"1-8-7-3","type":"branch","text":"诊断与鉴别诊断","children":[{"id":"1-8-7-3-1","type":"leaf","title":"诊断依据"},{"id":"1-8-7-3-2","type":"leaf","title":"鉴别诊断"}]},{"id":"1-8-7-4","type":"branch","text":"辨证论治","children":[{"id":"1-8-7-4-1","type":"branch","text":"辨证要点","children":[]},{"id":"1-8-7-4-2","type":"branch","text":"治疗原则","children":[]},{"id":"1-8-7-4-3","type":"branch","text":"证治分类","children":[{"id":"1-8-7-4-3-1","type":"branch","text":"气虚","children":[{"id":"1-8-7-4-3-1-1","type":"leaf","title":"肺气虚证"},{"id":"1-8-7-4-3-1-2","type":"leaf","title":"心气虚证"},{"id":"1-8-7-4-3-1-3","type":"leaf","title":"脾气虚证"},{"id":"1-8-7-4-3-1-4","type":"leaf","title":"肾气虚证"}]},{"id":"1-8-7-4-3-2","type":"branch","text":"血虚","children":[{"id":"1-8-7-4-3-2-1","type":"leaf","title":"心血虚证"},{"id":"1-8-7-4-3-2-2","type":"leaf","title":"肝血虚证"}]},{"id":"1-8-7-4-3-3","type":"branch","text":"阴虚","children":[{"id":"1-8-7-4-3-3-1","type":"leaf","title":"肺阴虚证"},{"id":"1-8-7-4-3-3-2","type":"leaf","title":"心阴虚证"},{"id":"1-8-7-4-3-3-3","type":"leaf","title":"脾胃阴虚证"},{"id":"1-8-7-4-3-3-4","type":"leaf","title":"肝阴虚证"},{"id":"1-8-7-4-3-3-5","type":"leaf","title":"肾阴虚证"}]},{"id":"1-8-7-4-3-4","type":"branch","text":"阳虚","children":[{"id":"1-8-7-4-3-4-1","type":"leaf","title":"心阳虚证"},{"id":"1-8-7-4-3-4-2","type":"leaf","title":"脾阳虚证"},{"id":"1-8-7-4-3-4-3","type":"leaf","title":"肾阳虚证"}]}]}]},{"id":"1-8-7-5","type":"branch","text":"转归预后","children":[]}]},{"id":"1-8-8","type":"branch","text":"癌病","children":[{"id":"1-8-8-1","type":"branch","text":"概述","children":[]},{"id":"1-8-8-2","type":"branch","text":"病因病机","children":[{"id":"1-8-8-2-1","type":"leaf","title":"病因"},{"id":"1-8-8-2-2","type":"leaf","title":"病机"}]},{"id":"1-8-8-3","type":"branch","text":"诊断与鉴别诊断","children":[{"id":"1-8-8-3-1","type":"leaf","title":"诊断依据"},{"id":"1-8-8-3-2","type":"leaf","title":"鉴别诊断"}]}]}]},{"id":"1-9","type":"branch","text":"肢体经络病证","children":[{"id":"1-9-1","type":"branch","text":"痹证","children":[{"id":"1-9-1-1","type":"branch","text":"概述","children":[]},{"id":"1-9-1-2","type":"branch","text":"病因病机","children":[{"id":"1-9-1-2-1","type":"leaf","title":"病因"},{"id":"1-9-1-2-2","type":"leaf","title":"病机"}]},{"id":"1-9-1-3","type":"branch","text":"诊断与鉴别诊断","children":[{"id":"1-9-1-3-1","type":"leaf","title":"诊断依据"},{"id":"1-9-1-3-2","type":"leaf","title":"鉴别诊断"}]},{"id":"1-9-1-4","type":"branch","text":"辨证论治","children":[{"id":"1-9-1-4-1","type":"branch","text":"辨证要点","children":[]},{"id":"1-9-1-4-2","type":"branch","text":"治疗原则","children":[]},{"id":"1-9-1-4-3","type":"branch","text":"证治分类","children":[{"id":"1-9-1-4-3-1","type":"branch","text":"风寒湿痹","children":[{"id":"1-9-1-4-3-1-1","type":"leaf","title":"行痹"},{"id":"1-9-1-4-3-1-2","type":"leaf","title":"痛痹"},{"id":"1-9-1-4-3-1-3","type":"leaf","title":"着痹"}]},{"id":"1-9-1-4-3-2","type":"branch","text":"风湿热痹","children":[]},{"id":"1-9-1-4-3-3","type":"branch","text":"痰瘀痹阻证","children":[]},{"id":"1-9-1-4-3-4","type":"branch","text":"寒热错杂证","children":[]},{"id":"1-9-1-4-3-5","type":"branch","text":"气血虚痹证","children":[]},{"id":"1-9-1-4-3-6","type":"branch","text":"肝肾虚痹证","children":[]}]}]},{"id":"1-9-1-5","type":"branch","text":"转归预后","children":[]},{"id":"1-9-1-6","type":"branch","text":"预防调护","children":[]}]},{"id":"1-9-2","type":"branch","text":"痿证","children":[{"id":"1-9-2-1","type":"branch","text":"概述","children":[]},{"id":"1-9-2-2","type":"branch","text":"病因病机","children":[{"id":"1-9-2-2-1","type":"leaf","title":"病因"},{"id":"1-9-2-2-2","type":"leaf","title":"病机"}]},{"id":"1-9-2-3","type":"branch","text":"诊断与鉴别诊断","children":[{"id":"1-9-2-3-1","type":"leaf","title":"诊断依据"},{"id":"1-9-2-3-2","type":"leaf","title":"鉴别诊断"}]},{"id":"1-9-2-4","type":"branch","text":"辨证论治","children":[{"id":"1-9-2-4-1","type":"leaf","title":"辨脏腑病位"},{"id":"1-9-2-4-2","type":"leaf","title":"治则治法"}]}]},{"id":"1-9-3","type":"branch","text":"颤证","children":[{"id":"1-9-3-1","type":"branch","text":"概述","children":[]},{"id":"1-9-3-2","type":"branch","text":"病因病机","children":[{"id":"1-9-3-2-1","type":"leaf","title":"病因"},{"id":"1-9-3-2-2","type":"leaf","title":"病机"}]},{"id":"1-9-3-3","type":"branch","text":"诊断与鉴别诊断","children":[{"id":"1-9-3-3-1","type":"leaf","title":"诊断依据"},{"id":"1-9-3-3-2","type":"leaf","title":"鉴别诊断"}]},{"id":"1-9-3-4","type":"branch","text":"辨证论治","children":[{"id":"1-9-3-4-1","type":"branch","text":"辨证要点","children":[]},{"id":"1-9-3-4-2","type":"branch","text":"治疗原则","children":[]},{"id":"1-9-3-4-3","type":"branch","text":"证治分类","children":[{"id":"1-9-3-4-3-1","type":"leaf","title":"风阳内动证"},{"id":"1-9-3-4-3-2","type":"leaf","title":"痰热风动证"},{"id":"1-9-3-4-3-3","type":"leaf","title":"气血亏虚证"},{"id":"1-9-3-4-3-4","type":"leaf","title":"髓海不足证"},{"id":"1-9-3-4-3-5","type":"leaf","title":"阳气虚衰证"}]}]}]},{"id":"1-9-4","type":"branch","text":"腰痛","children":[{"id":"1-9-4-1","type":"branch","text":"概述","children":[]},{"id":"1-9-4-2","type":"branch","text":"病因病机","children":[{"id":"1-9-4-2-1","type":"leaf","title":"病因"},{"id":"1-9-4-2-2","type":"leaf","title":"病机"}]},{"id":"1-9-4-3","type":"branch","text":"诊断与鉴别诊断","children":[{"id":"1-9-4-3-1","type":"leaf","title":"诊断依据"},{"id":"1-9-4-3-2","type":"leaf","title":"鉴别诊断"}]},{"id":"1-9-4-4","type":"branch","text":"辨证论治","children":[{"id":"1-9-4-4-1","type":"branch","text":"辨证要点","children":[]},{"id":"1-9-4-4-2","type":"branch","text":"治疗原则","children":[]},{"id":"1-9-4-4-3","type":"branch","text":"证治分类","children":[{"id":"1-9-4-4-3-1","type":"branch","text":"寒湿腰痛","children":[]},{"id":"1-9-4-4-3-2","type":"branch","text":"湿热腰痛","children":[]},{"id":"1-9-4-4-3-3","type":"branch","text":"瘀血腰痛","children":[]},{"id":"1-9-4-4-3-4","type":"branch","text":"肾虚腰痛","children":[{"id":"1-9-4-4-3-4-1","type":"leaf","title":"肾阴虚"},{"id":"1-9-4-4-3-4-2","type":"leaf","title":"肾阳虚"}]}]}]}]}]},{"id":"1-10","type":"branch","text":"脑系病证","children":[{"id":"1-10-1","type":"branch","text":"头痛","children":[{"id":"1-10-1-1","type":"branch","text":"概述","children":[]},{"id":"1-10-1-2","type":"branch","text":"病因病机","children":[{"id":"1-10-1-2-1","type":"leaf","title":"病因"},{"id":"1-10-1-2-2","type":"leaf","title":"病机"}]},{"id":"1-10-1-3","type":"branch","text":"诊断与鉴别诊断","children":[{"id":"1-10-1-3-1","type":"leaf","title":"诊断要点"},{"id":"1-10-1-3-2","type":"leaf","title":"鉴别诊断"},{"id":"1-10-1-3-3","type":"leaf","title":"真头痛与一般头痛"}]},{"id":"1-10-1-4","type":"branch","text":"辨别头痛的不同部位","children":[]},{"id":"1-10-1-5","type":"branch","text":"辨证论治","children":[{"id":"1-10-1-5-1","type":"branch","text":"辨证要点","children":[]},{"id":"1-10-1-5-2","type":"branch","text":"治疗原则","children":[]},{"id":"1-10-1-5-3","type":"branch","text":"证治分类","children":[{"id":"1-10-1-5-3-1","type":"branch","text":"外感头痛","children":[{"id":"1-10-1-5-3-1-1","type":"leaf","title":"风寒头痛"},{"id":"1-10-1-5-3-1-2","type":"leaf","title":"风热头痛"},{"id":"1-10-1-5-3-1-3","type":"leaf","title":"风湿头痛"}]},{"id":"1-10-1-5-3-2","type":"branch","text":"内伤头痛","children":[{"id":"1-10-1-5-3-2-1","type":"leaf","title":"肝阳头痛"},{"id":"1-10-1-5-3-2-2","type":"leaf","title":"血虚头痛"},{"id":"1-10-1-5-3-2-3","type":"leaf","title":"痰浊头痛"},{"id":"1-10-1-5-3-2-4","type":"leaf","title":"肾虚头痛"},{"id":"1-10-1-5-3-2-5","type":"leaf","title":"瘀血头痛"},{"id":"1-10-1-5-3-2-6","type":"leaf","title":"气虚头痛"}]}]}]},{"id":"1-10-1-6","type":"branch","text":"根据头痛的不同部位选用不同的“引经药”","children":[]},{"id":"1-10-1-7","type":"branch","text":"转归预后","children":[]}]},{"id":"1-10-2","type":"branch","text":"眩晕","children":[{"id":"1-10-2-1","type":"branch","text":"概述","children":[]},{"id":"1-10-2-2","type":"branch","text":"病因病机","children":[{"id":"1-10-2-2-1","type":"leaf","title":"病因"},{"id":"1-10-2-2-2","type":"leaf","title":"病机"}]},{"id":"1-10-2-3","type":"branch","text":"诊断与鉴别诊断","children":[{"id":"1-10-2-3-1","type":"leaf","title":"诊断依据"},{"id":"1-10-2-3-2","type":"leaf","title":"鉴别诊断"}]},{"id":"1-10-2-4","type":"branch","text":"辨证论治","children":[{"id":"1-10-2-4-1","type":"branch","text":"辨证要点","children":[]},{"id":"1-10-2-4-2","type":"branch","text":"治疗原则","children":[]},{"id":"1-10-2-4-3","type":"branch","text":"证治分类","children":[{"id":"1-10-2-4-3-1","type":"leaf","title":"肝阳上亢证"},{"id":"1-10-2-4-3-2","type":"leaf","title":"气血亏虚证"},{"id":"1-10-2-4-3-3","type":"leaf","title":"肾精不足证"},{"id":"1-10-2-4-3-4","type":"leaf","title":"痰湿中阻证"},{"id":"1-10-2-4-3-5","type":"leaf","title":"瘀血阻窍证"}]}]},{"id":"1-10-2-5","type":"branch","text":"转归预后","children":[]},{"id":"1-10-2-6","type":"branch","text":"预防调护","children":[]}]},{"id":"1-10-3","type":"branch","text":"中风","children":[{"id":"1-10-3-1","type":"branch","text":"概述","children":[]},{"id":"1-10-3-2","type":"branch","text":"病因病机","children":[{"id":"1-10-3-2-1","type":"leaf","title":"病因"},{"id":"1-10-3-2-2","type":"leaf","title":"病机"}]},{"id":"1-10-3-3","type":"branch","text":"诊断与鉴别诊断","children":[{"id":"1-10-3-3-1","type":"leaf","title":"诊断依据"},{"id":"1-10-3-3-2","type":"leaf","title":"鉴别诊断"}]},{"id":"1-10-3-4","type":"branch","text":"辨证论治","children":[{"id":"1-10-3-4-1","type":"branch","text":"辨证要点","children":[]},{"id":"1-10-3-4-2","type":"branch","text":"治疗原则","children":[]},{"id":"1-10-3-4-3","type":"branch","text":"证治分类","children":[{"id":"1-10-3-4-3-1","type":"branch","text":"中经络","children":[{"id":"1-10-3-4-3-1-1","type":"leaf","title":"风痰入络证"},{"id":"1-10-3-4-3-1-2","type":"leaf","title":"风阳上扰证"},{"id":"1-10-3-4-3-1-3","type":"leaf","title":"阴虚风动证"}]},{"id":"1-10-3-4-3-2","type":"branch","text":"中脏腑","children":[{"id":"1-10-3-4-3-2-1","type":"leaf","title":"闭证"},{"id":"1-10-3-4-3-2-2","type":"leaf","title":"脱证"}]},{"id":"1-10-3-4-3-3","type":"branch","text":"恢复期和后遗症期","children":[{"id":"1-10-3-4-3-3-1","type":"leaf","title":"风痰瘀阻证"},{"id":"1-10-3-4-3-3-2","type":"leaf","title":"气虚络瘀证"},{"id":"1-10-3-4-3-3-3","type":"leaf","title":"肝肾亏虚证"}]}]}]},{"id":"1-10-3-5","type":"branch","text":"转归预后","children":[]},{"id":"1-10-3-6","type":"branch","text":"预防调护","children":[]}]},{"id":"1-10-4","type":"branch","text":"痫病","children":[{"id":"1-10-4-1","type":"branch","text":"概述","children":[]},{"id":"1-10-4-2","type":"branch","text":"病因病机","children":[{"id":"1-10-4-2-1","type":"leaf","title":"病因"},{"id":"1-10-4-2-2","type":"leaf","title":"病机"}]},{"id":"1-10-4-3","type":"branch","text":"诊断","children":[]}]},{"id":"1-10-5","type":"branch","text":"痴呆","children":[{"id":"1-10-5-1","type":"branch","text":"概述","children":[]},{"id":"1-10-5-2","type":"branch","text":"病因病机","children":[{"id":"1-10-5-2-1","type":"leaf","title":"病因"},{"id":"1-10-5-2-2","type":"leaf","title":"病机"}]},{"id":"1-10-5-3","type":"branch","text":"诊断与鉴别诊断","children":[{"id":"1-10-5-3-1","type":"leaf","title":"诊断依据"},{"id":"1-10-5-3-2","type":"leaf","title":"鉴别诊断"}]},{"id":"1-10-5-4","type":"branch","text":"辨证论治","children":[{"id":"1-10-5-4-1","type":"branch","text":"辨证要点","children":[]},{"id":"1-10-5-4-2","type":"branch","text":"治疗原则","children":[]},{"id":"1-10-5-4-3","type":"branch","text":"证治分类","children":[{"id":"1-10-5-4-3-1","type":"leaf","title":"髓海不足证"},{"id":"1-10-5-4-3-2","type":"leaf","title":"脾肾两虚证"},{"id":"1-10-5-4-3-3","type":"leaf","title":"气血不足证"},{"id":"1-10-5-4-3-4","type":"leaf","title":"痰浊蒙窍证"},{"id":"1-10-5-4-3-5","type":"leaf","title":"瘀阻脑络证"},{"id":"1-10-5-4-3-6","type":"leaf","title":"心肝火旺证"},{"id":"1-10-5-4-3-7","type":"leaf","title":"热毒内盛证"}]}]}]}]},{"id":"1-11","type":"branch","text":"肺系病证","children":[{"id":"1-11-1","type":"branch","text":"感冒","children":[{"id":"1-11-1-1","type":"branch","text":"概述","children":[]},{"id":"1-11-1-2","type":"branch","text":"病因病机","children":[{"id":"1-11-1-2-1","type":"leaf","title":"病因"},{"id":"1-11-1-2-2","type":"leaf","title":"病机"}]},{"id":"1-11-1-3","type":"branch","text":"诊断与鉴别诊断","children":[{"id":"1-11-1-3-1","type":"leaf","title":"诊断依据"},{"id":"1-11-1-3-2","type":"leaf","title":"鉴别诊断"}]},{"id":"1-11-1-4","type":"branch","text":"辨证论治","children":[{"id":"1-11-1-4-1","type":"branch","text":"辨证要点","children":[]},{"id":"1-11-1-4-2","type":"branch","text":"治疗原则","children":[]},{"id":"1-11-1-4-3","type":"branch","text":"证治分类","children":[{"id":"1-11-1-4-3-1","type":"branch","text":"常人感冒","children":[{"id":"1-11-1-4-3-1-1","type":"leaf","title":"风寒束表证"},{"id":"1-11-1-4-3-1-2","type":"leaf","title":"风热犯表证"},{"id":"1-11-1-4-3-1-3","type":"leaf","title":"暑湿伤表证"}]},{"id":"1-11-1-4-3-2","type":"branch","text":"虚体感冒","children":[{"id":"1-11-1-4-3-2-1","type":"leaf","title":"气虚感冒"},{"id":"1-11-1-4-3-2-2","type":"leaf","title":"阴虚感冒"}]}]}]},{"id":"1-11-1-5","type":"branch","text":"转归预后","children":[]},{"id":"1-11-1-6","type":"branch","text":"预防调护","children":[]}]},{"id":"1-11-2","type":"branch","text":"咳嗽","children":[{"id":"1-11-2-1","type":"branch","text":"概述","children":[]},{"id":"1-11-2-2","type":"branch","text":"病因病机","children":[{"id":"1-11-2-2-1","type":"leaf","title":"病因"},{"id":"1-11-2-2-2","type":"leaf","title":"病机"}]},{"id":"1-11-2-3","type":"branch","text":"诊断与鉴别诊断","children":[{"id":"1-11-2-3-1","type":"leaf","title":"诊断依据"},{"id":"1-11-2-3-2","type":"leaf","title":"鉴别诊断"}]},{"id":"1-11-2-4","type":"branch","text":"辨证论治","children":[{"id":"1-11-2-4-1","type":"branch","text":"辨证要点","children":[]},{"id":"1-11-2-4-2","type":"branch","text":"治疗原则","children":[]},{"id":"1-11-2-4-3","type":"branch","text":"证治分类","children":[{"id":"1-11-2-4-3-1","type":"branch","text":"外感咳嗽","children":[{"id":"1-11-2-4-3-1-1","type":"leaf","title":"风寒袭肺证"},{"id":"1-11-2-4-3-1-2","type":"leaf","title":"风热犯肺证"},{"id":"1-11-2-4-3-1-3","type":"leaf","title":"风燥伤肺证"}]},{"id":"1-11-2-4-3-2","type":"branch","text":"内伤咳嗽","children":[{"id":"1-11-2-4-3-2-1","type":"leaf","title":"痰湿蕴肺证"},{"id":"1-11-2-4-3-2-2","type":"leaf","title":"痰热郁肺证"},{"id":"1-11-2-4-3-2-3","type":"leaf","title":"肝火犯肺证"},{"id":"1-11-2-4-3-2-4","type":"leaf","title":"肺阴亏耗证"}]}]}]},{"id":"1-11-2-5","type":"branch","text":"转归预后","children":[]},{"id":"1-11-2-6","type":"branch","text":"预防调护","children":[]}]},{"id":"1-11-3","type":"branch","text":"哮病","children":[{"id":"1-11-3-1","type":"branch","text":"概述","children":[]},{"id":"1-11-3-2","type":"branch","text":"病因病机","children":[{"id":"1-11-3-2-1","type":"leaf","title":"病因"},{"id":"1-11-3-2-2","type":"leaf","title":"病机"}]},{"id":"1-11-3-3","type":"branch","text":"诊断与鉴别诊断","children":[{"id":"1-11-3-3-1","type":"leaf","title":"诊断依据"},{"id":"1-11-3-3-2","type":"leaf","title":"鉴别诊断"}]},{"id":"1-11-3-4","type":"branch","text":"辨证论治","children":[{"id":"1-11-3-4-1","type":"branch","text":"辨证要点","children":[]},{"id":"1-11-3-4-2","type":"branch","text":"治疗原则","children":[]},{"id":"1-11-3-4-3","type":"branch","text":"证治分类","children":[{"id":"1-11-3-4-3-1","type":"branch","text":"发作期","children":[{"id":"1-11-3-4-3-1-1","type":"leaf","title":"冷哮证"},{"id":"1-11-3-4-3-1-2","type":"leaf","title":"热哮证"},{"id":"1-11-3-4-3-1-3","type":"leaf","title":"寒包热哮证"},{"id":"1-11-3-4-3-1-4","type":"leaf","title":"风痰哮证"},{"id":"1-11-3-4-3-1-5","type":"leaf","title":"虚哮证"}]},{"id":"1-11-3-4-3-2","type":"branch","text":"缓解期","children":[{"id":"1-11-3-4-3-2-1","type":"leaf","title":"肺虚"},{"id":"1-11-3-4-3-2-2","type":"leaf","title":"脾虚"},{"id":"1-11-3-4-3-2-3","type":"leaf","title":"肾虚"}]}]}]},{"id":"1-11-3-5","type":"branch","text":"转归预后","children":[]},{"id":"1-11-3-6","type":"branch","text":"预防调护","children":[]}]},{"id":"1-11-4","type":"branch","text":"喘证","children":[{"id":"1-11-4-1","type":"branch","text":"概述","children":[]},{"id":"1-11-4-2","type":"branch","text":"病因病机","children":[{"id":"1-11-4-2-1","type":"leaf","title":"病因"},{"id":"1-11-4-2-2","type":"leaf","title":"病机"}]},{"id":"1-11-4-3","type":"branch","text":"诊断与鉴别诊断","children":[{"id":"1-11-4-3-1","type":"leaf","title":"诊断依据"},{"id":"1-11-4-3-2","type":"leaf","title":"鉴别诊断"}]},{"id":"1-11-4-4","type":"branch","text":"辨证论治","children":[{"id":"1-11-4-4-1","type":"branch","text":"辨证要点","children":[]},{"id":"1-11-4-4-2","type":"branch","text":"治疗原则","children":[]},{"id":"1-11-4-4-3","type":"branch","text":"证治分类","children":[{"id":"1-11-4-4-3-1","type":"branch","text":"实喘","children":[{"id":"1-11-4-4-3-1-1","type":"leaf","title":"风寒壅肺证"},{"id":"1-11-4-4-3-1-2","type":"leaf","title":"表寒肺热证"},{"id":"1-11-4-4-3-1-3","type":"leaf","title":"痰热郁肺证"},{"id":"1-11-4-4-3-1-4","type":"leaf","title":"痰浊阻肺证"},{"id":"1-11-4-4-3-1-5","type":"leaf","title":"肺气郁痹证"}]},{"id":"1-11-4-4-3-2","type":"branch","text":"虚喘","children":[{"id":"1-11-4-4-3-2-1","type":"leaf","title":"肺气虚耗证"},{"id":"1-11-4-4-3-2-2","type":"leaf","title":"肾虚不纳证"},{"id":"1-11-4-4-3-2-3","type":"leaf","title":"正虚喘脱证"}]}]}]},{"id":"1-11-4-5","type":"branch","text":"转归预后","children":[]},{"id":"1-11-4-6","type":"branch","text":"预防调护","children":[]}]},{"id":"1-11-5","type":"branch","text":"肺痈","children":[{"id":"1-11-5-1","type":"branch","text":"概述","children":[]},{"id":"1-11-5-2","type":"branch","text":"病因病机","children":[{"id":"1-11-5-2-1","type":"leaf","title":"病因"},{"id":"1-11-5-2-2","type":"leaf","title":"病机"}]},{"id":"1-11-5-3","type":"branch","text":"诊断与鉴别诊断","children":[{"id":"1-11-5-3-1","type":"leaf","title":"诊断依据"},{"id":"1-11-5-3-2","type":"leaf","title":"鉴别诊断"}]},{"id":"1-11-5-4","type":"branch","text":"辨证论治","children":[{"id":"1-11-5-4-1","type":"branch","text":"辨证要点","children":[]},{"id":"1-11-5-4-2","type":"branch","text":"治疗原则","children":[]},{"id":"1-11-5-4-3","type":"branch","text":"证治分类","children":[{"id":"1-11-5-4-3-1","type":"leaf","title":"初期"},{"id":"1-11-5-4-3-2","type":"leaf","title":"成痈期"},{"id":"1-11-5-4-3-3","type":"leaf","title":"溃脓期"},{"id":"1-11-5-4-3-4","type":"leaf","title":"恢复期"}]}]},{"id":"1-11-5-5","type":"branch","text":"转归预后","children":[]}]},{"id":"1-11-6","type":"branch","text":"肺痨","children":[{"id":"1-11-6-1","type":"branch","text":"概述","children":[]},{"id":"1-11-6-2","type":"branch","text":"病因病机","children":[{"id":"1-11-6-2-1","type":"leaf","title":"病因"},{"id":"1-11-6-2-2","type":"leaf","title":"病机"}]},{"id":"1-11-6-3","type":"branch","text":"诊断与鉴别诊断","children":[{"id":"1-11-6-3-1","type":"leaf","title":"诊断依据"},{"id":"1-11-6-3-2","type":"leaf","title":"鉴别诊断"}]},{"id":"1-11-6-4","type":"branch","text":"辨证论治","children":[{"id":"1-11-6-4-1","type":"branch","text":"辨证要点","children":[]},{"id":"1-11-6-4-2","type":"branch","text":"治疗原则","children":[]},{"id":"1-11-6-4-3","type":"branch","text":"证治分类","children":[{"id":"1-11-6-4-3-1","type":"leaf","title":"肺阴亏损证"},{"id":"1-11-6-4-3-2","type":"leaf","title":"虚火灼肺证"},{"id":"1-11-6-4-3-3","type":"leaf","title":"气阴耗伤证"},{"id":"1-11-6-4-3-4","type":"leaf","title":"阴阳两虚证"}]}]},{"id":"1-11-6-5","type":"branch","text":"预防调护","children":[]}]},{"id":"1-11-7","type":"branch","text":"肺胀","children":[{"id":"1-11-7-1","type":"branch","text":"概述","children":[]},{"id":"1-11-7-2","type":"branch","text":"病因病机","children":[{"id":"1-11-7-2-1","type":"leaf","title":"病因"},{"id":"1-11-7-2-2","type":"leaf","title":"病机"}]},{"id":"1-11-7-3","type":"branch","text":"诊断与鉴别诊断","children":[{"id":"1-11-7-3-1","type":"leaf","title":"诊断依据"},{"id":"1-11-7-3-2","type":"leaf","title":"鉴别诊断"}]},{"id":"1-11-7-4","type":"branch","text":"辨证论治","children":[{"id":"1-11-7-4-1","type":"branch","text":"辨证要点","children":[]},{"id":"1-11-7-4-2","type":"branch","text":"治疗原则","children":[]},{"id":"1-11-7-4-3","type":"branch","text":"证治分类","children":[{"id":"1-11-7-4-3-1","type":"leaf","title":"外寒里饮证"},{"id":"1-11-7-4-3-2","type":"leaf","title":"痰浊壅肺证"},{"id":"1-11-7-4-3-3","type":"leaf","title":"痰热郁肺证"},{"id":"1-11-7-4-3-4","type":"leaf","title":"痰蒙神窍证"},{"id":"1-11-7-4-3-5","type":"leaf","title":"痰瘀阻肺证"},{"id":"1-11-7-4-3-6","type":"leaf","title":"阳虚水泛证"},{"id":"1-11-7-4-3-7","type":"leaf","title":"肺肾气虚证"}]}]}]}]}]};

      // --- 2. 配置参数 ---
      const CONFIG = {
        nodeXGap: 60,
        nodeYGap: 20,
        cardWidth: 260,
        pillWidth: 160,
        cardHeight: 90,
        pillHeight: 40,
      };

      // --- 3. 核心变量 ---
      let flatNodes = [];
      let isAllExpanded = false;
      let isLoadingData = false;
      const canvas = document.getElementById('canvas');
      const domLayer = document.getElementById('dom-layer');
      const svgLayer = document.getElementById('svg-layer');
      const viewport = document.getElementById('viewport');
      const debugPanel = document.getElementById('rn-debug');

      // --- 文本清理函数 ---
      function cleanNodeText(text) {
        if (!text) return '';

        return text
          .replace(/\r\n/g, ' ')
          .replace(/\r/g, ' ')
          .replace(/\n/g, ' ')
          .replace(/\s+/g, ' ')
          .trim();
      }

      // --- RN WebView 通信接口 ---
      const RNInterface = {
        // 新增：水印配置
        WATERMARK_CONFIG: {
          enabled: true,
          text: '思维导图',
          fontSize: 16,
          opacity: 0.15, //设置透明度
          color: '#000000',
          spacing: 200, // 水印之间的间距
          angle: -20, // 旋转角度
        },

        MAX_BASE64_SIZE: 1500000,

        getOptimizedQuality: function (quality = 0.6) {
          return Math.max(0.3, Math.min(1.0, quality));
        },

        checkBase64Size: function (base64) {
          const size = base64.length;
          const fileSizeMB = ((size * 0.75) / 1024 / 1024).toFixed(2);

          return {
            size: size,
            isSafe: size <= this.MAX_BASE64_SIZE,
            fileSizeMB: fileSizeMB,
            maxSizeMB: ((this.MAX_BASE64_SIZE * 0.75) / 1024 / 1024).toFixed(2),
          };
        },

        optimizeBase64Size: async function (base64, context = 'full_map') {
          const checkResult = this.checkBase64Size(base64);

          if (checkResult.isSafe) {
            return base64;
          }

          try {
            const img = new Image();

            return new Promise(resolve => {
              img.onload = () => {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');

                canvas.width = img.width;
                canvas.height = img.height;
                ctx.drawImage(img, 0, 0);

                const qualitySteps = [0.5, 0.4, 0.3, 0.2];
                let optimizedBase64 = base64;

                for (let i = 0; i < qualitySteps.length; i++) {
                  const quality = qualitySteps[i];
                  const testBase64 = canvas.toDataURL('image/png', quality);
                  const cleaned = testBase64.replace(/\n/g, '');

                  const newCheck = this.checkBase64Size(cleaned);

                  if (newCheck.isSafe) {
                    optimizedBase64 = cleaned;
                    break;
                  }

                  if (i === qualitySteps.length - 1) {
                    optimizedBase64 = cleaned;
                  }
                }

                resolve(optimizedBase64);
              };

              img.onerror = () => {
                resolve(base64);
              };

              img.src = base64;
            });
          } catch (error) {
            return base64;
          }
        },

        // 新增：绘制水印函数
        drawWatermark: function (ctx, width, height) {
          if (!this.WATERMARK_CONFIG.enabled) return;

          const { text, fontSize, opacity, color, spacing, angle } = this.WATERMARK_CONFIG;

          ctx.save();
          ctx.globalAlpha = opacity;
          ctx.fillStyle = color;
          ctx.font = `bold ${fontSize}px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif`;
          ctx.textAlign = 'center';
          ctx.textBaseline = 'middle';

          // 计算水印需要的空间
          const textWidth = ctx.measureText(text).width;
          const textHeight = fontSize;

          // 计算水印数量
          const cols = Math.ceil(width / spacing) + 1;
          const rows = Math.ceil(height / spacing) + 1;

          // 旋转画布
          const radians = (angle * Math.PI) / 180;
          ctx.translate(width / 2, height / 2);
          ctx.rotate(radians);
          ctx.translate(-width / 2, -height / 2);

          // 绘制网格水印
          for (let i = 0; i < cols; i++) {
            for (let j = 0; j < rows; j++) {
              const x = i * spacing;
              const y = j * spacing;

              // 交错位置使水印更自然
              const offsetX = (j % 2) * (spacing / 2);
              const drawX = x + offsetX;
              const drawY = y + textHeight / 2;

              ctx.fillText(text, drawX, drawY);
            }
          }

          ctx.restore();
        },

        // 新增：添加水印到图片
        addWatermarkToImage: async function (imageData, width, height) {
          return new Promise(resolve => {
            const img = new Image();

            img.onload = () => {
              const canvas = document.createElement('canvas');
              const ctx = canvas.getContext('2d');

              canvas.width = width;
              canvas.height = height;

              // 绘制原始图片
              ctx.drawImage(img, 0, 0, width, height);

              // 绘制水印
              this.drawWatermark(ctx, width, height);

              // 返回带水印的Base64
              const watermarkedBase64 = canvas.toDataURL('image/png', 0.9);
              resolve(watermarkedBase64);
            };

            img.onerror = () => {
              resolve(imageData);
            };

            img.src = imageData;
          });
        },

        requestData: function () {
          this.postMessage('request_data', {
            timestamp: Date.now(),
          });
        },

        updateData: function (newData) {
          try {
            isLoadingData = true;

            function cleanDataRecursive(node) {
              if (node.text) {
                node.text = cleanNodeText(node.text);
              }
              if (node.title) {
                node.title = cleanNodeText(node.title);
              }
              if (node.desc) {
                node.desc = cleanNodeText(node.desc);
              }
              if (node.children) {
                node.children.forEach(child => cleanDataRecursive(child));
              }
            }

            cleanDataRecursive(newData);
            mindMapData = newData;
            isAllExpanded = false;
            initDataRecursive(mindMapData, 0);
            render();
            updateExpandCollapseButton();
            isLoadingData = false;
          } catch (error) {
            isLoadingData = false;
          }
        },

        postMessage: function (type, data = {}) {
          const message = {
            type: type,
            data: data,
            timestamp: Date.now(),
          };

          try {
            if (window.ReactNativeWebView && window.ReactNativeWebView.postMessage) {
              window.ReactNativeWebView.postMessage(JSON.stringify(message));
            } else if (window.postMessage) {
              window.postMessage(JSON.stringify(message), '*');
            } else {
              if (type === 'save_image') {
                this.showBrowserDownload(data.imageData);
              }
            }
          } catch (error) {
            // 错误处理
          }
        },

        setupMessageListener: function () {
          window.addEventListener('message', event => {
            try {
              const message = typeof event.data === 'string' ? JSON.parse(event.data) : event.data;

              if (message.type === 'request_screenshot') {
                const { viewType, quality = 0.6 } = message.data || {};
                this.handleScreenshotRequest(viewType, quality);
              } else if (message.type === 'update_data') {
                const { data } = message.data || {};
                if (data) {
                  this.updateData(data);
                }
              } else if (message.type === 'clear_data') {
                this.clearData();
              }
            } catch (error) {
              // 错误处理
            }
          });

          document.addEventListener('message', event => {
            try {
              const message = typeof event.data === 'string' ? JSON.parse(event.data) : event.data;

              if (message.type === 'request_screenshot') {
                const { viewType, quality = 0.6 } = message.data || {};
                this.handleScreenshotRequest(viewType, quality);
              } else if (message.type === 'update_data') {
                const { data } = message.data || {};
                if (data) {
                  this.updateData(data);
                }
              } else if (message.type === 'clear_data') {
                this.clearData();
              }
            } catch (error) {
              // 错误处理
            }
          });

          document.addEventListener('visibilitychange', () => {
            if (!document.hidden && !isLoadingData) {
              setTimeout(() => {
                this.requestData();
              }, 100);
            }
          });
        },

        clearData: function () {
          mindMapData = {
            id: 'root',
            type: 'root',
            text: '暂无数据',
            children: [],
          };

          initDataRecursive(mindMapData, 0);
          render();
          updateExpandCollapseButton();
        },

        // 修改：处理截图请求 - 添加水印
        handleScreenshotRequest: async function (viewType = 'current', quality = 0.6) {
          const optimizedQuality = this.getOptimizedQuality(quality);

          try {
            let imageData;
            const context = viewType === 'full' ? 'full_map' : 'current_view';

            if (viewType === 'full') {
              imageData = await this.generateFullMapScreenshot(optimizedQuality);
            } else {
              imageData = await this.generateCurrentViewScreenshot(optimizedQuality);
            }

            // 清理换行符
            const cleanedImageData = imageData.replace(/\n/g, '');

            // 添加水印
            let watermarkedImageData = cleanedImageData;
            if (this.WATERMARK_CONFIG.enabled) {
              try {
                const img = new Image();
                await new Promise(resolve => {
                  img.onload = () => {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');

                    canvas.width = img.width;
                    canvas.height = img.height;

                    // 绘制原始图片
                    ctx.drawImage(img, 0, 0);

                    // 绘制水印
                    this.drawWatermark(ctx, img.width, img.height);

                    // 获取带水印的图片
                    watermarkedImageData = canvas.toDataURL('image/png', optimizedQuality);
                    resolve();
                  };
                  img.onerror = () => {
                    watermarkedImageData = cleanedImageData;
                    resolve();
                  };
                  img.src = cleanedImageData;
                });
              } catch (watermarkError) {
                watermarkedImageData = cleanedImageData;
              }
            }

            // 检查并优化大小
            const optimizedImageData = await this.optimizeBase64Size(watermarkedImageData, context);

            // 发送截图数据到RN
            this.postMessage('save_image', {
              imageData: optimizedImageData,
              viewType: viewType,
              quality: optimizedQuality,
              optimized: cleanedImageData !== optimizedImageData,
              originalSize: cleanedImageData.length,
              finalSize: optimizedImageData.length,
              watermarked:
                this.WATERMARK_CONFIG.enabled && cleanedImageData !== watermarkedImageData,
            });

            setTimeout(() => {
              RNInterface.postMessage('download_started', {
                action: 'full_map_error',
                timestamp: Date.now(),
                buttonId: 'download-full-btn',
              });
            }, 500);
          } catch (error) {
            RNInterface.postMessage('download_started', {
              action: 'full_map_error',
              timestamp: Date.now(),
              buttonId: 'download-full-btn',
            });
            this.postMessage('save_image_error', {
              error: error.message,
              viewType: viewType,
            });
          }
        },

        // 修改：生成当前视图截图
        generateCurrentViewScreenshot: async function (quality = 0.6) {
          const optimizedQuality = this.getOptimizedQuality(quality);
          const rect = viewport.getBoundingClientRect();
          const width = rect.width;
          const height = rect.height;

          const canvas = document.createElement('canvas');
          canvas.width = width * 2;
          canvas.height = height * 2;
          const ctx = canvas.getContext('2d');

          ctx.fillStyle = '#f0f2f5';
          ctx.fillRect(0, 0, canvas.width, canvas.height);
          this.drawGridBackground(ctx, canvas.width, canvas.height);

          const transform = window.getComputedStyle(canvas.parentElement).transform;
          const matrix = new DOMMatrix(transform);

          ctx.setTransform(
            matrix.a * 2,
            matrix.b * 2,
            matrix.c * 2,
            matrix.d * 2,
            matrix.e * 2,
            matrix.f * 2,
          );

          this.drawMindMapContent(ctx);
          ctx.setTransform(1, 0, 0, 1, 0, 0);

          return canvas.toDataURL('image/png', optimizedQuality);
        },

        // 修改：生成完整思维导图截图
        generateFullMapScreenshot: async function (quality = 0.6) {
          const optimizedQuality = this.getOptimizedQuality(quality);
          const bounds = this.getMindMapBounds();
          const padding = 40;

          const originalWidth = Math.max(100, bounds.width + padding * 2);
          const originalHeight = Math.max(100, bounds.height + padding * 2);

          let targetScale = 1.0;
          let targetWidth = originalWidth;
          let targetHeight = originalHeight;

          const originalPixels = originalWidth * originalHeight;

          if (originalPixels < 2000000) {
            targetScale = 4.0;
            console.log('✨ 小图模式：使用3倍高清');
          } else if (originalPixels < 5000000) {
            targetScale = 3.0;
            console.log('📱 中图模式：使用2倍高清');
          } else if (originalPixels < 10000000) {
            targetScale = 2.5;
            console.log('🖥️ 大图模式：使用1.5倍');
          } else {
            targetScale = 2.0;
            console.log('🏗️ 超大图模式：保持原尺寸');
          }

          targetWidth = Math.floor(originalWidth * targetScale);
          targetHeight = Math.floor(originalHeight * targetScale);

          const SAFE_MAX_DIMENSION = 60000;
          const SAFE_MAX_PIXELS = 600000000;

          if (
            targetWidth > SAFE_MAX_DIMENSION ||
            targetHeight > SAFE_MAX_DIMENSION ||
            targetWidth * targetHeight > SAFE_MAX_PIXELS
          ) {
            const widthRatio = SAFE_MAX_DIMENSION / targetWidth;
            const heightRatio = SAFE_MAX_DIMENSION / targetHeight;
            const pixelRatio = Math.sqrt(SAFE_MAX_PIXELS / (targetWidth * targetHeight));

            const safeScale = Math.min(widthRatio, heightRatio, pixelRatio);

            targetWidth = Math.floor(targetWidth * safeScale);
            targetHeight = Math.floor(targetHeight * safeScale);
            targetScale = targetScale * safeScale;
          }

          const canvas = document.createElement('canvas');
          canvas.width = targetWidth;
          canvas.height = targetHeight;
          const ctx = canvas.getContext('2d');

          if (!ctx) {
            throw new Error('❌ 无法获取Canvas上下文');
          }

          ctx.fillStyle = '#f0f2f5';
          ctx.fillRect(0, 0, canvas.width, canvas.height);
          this.drawGridBackground(ctx, canvas.width, canvas.height);

          if (targetScale !== 1.0) {
            ctx.scale(targetScale, targetScale);
          }

          this.drawMindMapToCanvas(ctx, bounds, padding);

          const sampleData = ctx.getImageData(
            Math.min(50, canvas.width - 1),
            Math.min(50, canvas.height - 1),
            1,
            1,
          ).data;

          const finalQuality = Math.min(0.9, Math.max(0.8, optimizedQuality));

          const base64 = canvas.toDataURL('image/png', finalQuality);

          if (base64.length < 5000) {
            const testCanvas = document.createElement('canvas');
            testCanvas.width = 800;
            testCanvas.height = 600;
            const testCtx = testCanvas.getContext('2d');

            testCtx.fillStyle = '#3498db';
            testCtx.fillRect(0, 0, 800, 600);

            testCtx.fillStyle = 'white';
            testCtx.font = 'bold 28px Arial';
            testCtx.textAlign = 'center';
            testCtx.fillText('思维导图截图', 400, 200);

            testCtx.font = '20px Arial';
            testCtx.fillText(`原始尺寸: ${originalWidth}×${originalHeight}`, 400, 250);
            testCtx.fillText(`目标尺寸: ${targetWidth}×${targetHeight}`, 400, 300);
            testCtx.fillText(`缩放比例: ${targetScale.toFixed(2)}x`, 400, 350);

            testCtx.font = '18px Arial';
            testCtx.fillStyle = '#f1c40f';
            testCtx.fillText('⚠️ 如果看不到导图内容，请检查节点数据', 400, 450);

            return testCanvas.toDataURL('image/png', 0.95);
          }
          return base64;
        },

        drawGridBackground: function (ctx, width, height) {
          const gridSize = 24 * 2;
          const dotSize = 1.5 * 2;

          ctx.fillStyle = '#d1d5db';

          for (let x = 0; x < width; x += gridSize) {
            for (let y = 0; y < height; y += gridSize) {
              ctx.beginPath();
              ctx.arc(x, y, dotSize, 0, Math.PI * 2);
              ctx.fill();
            }
          }
        },

        drawMindMapContent: function (ctx) {
          this.drawConnections(ctx);
          this.drawNodes(ctx);
        },

        drawConnections: function (ctx) {
          ctx.strokeStyle = '#bdc3c7';
          ctx.lineWidth = 2;
          ctx.lineCap = 'round';

          flatNodes.forEach(node => {
            if (node.children && node.children.length > 0 && !node.collapsed) {
              const startX = node.x + node.w;
              const startY = node.y;

              node.children.forEach(child => {
                const endX = child.x;
                const endY = child.y;

                const cpOffset = CONFIG.nodeXGap * 0.6;

                ctx.beginPath();
                ctx.moveTo(startX, startY);
                ctx.bezierCurveTo(startX + cpOffset, startY, endX - cpOffset, endY, endX, endY);
                ctx.stroke();
              });
            }
          });
        },

        drawNodes: function (ctx) {
          flatNodes.forEach(node => {
            const x = node.x;
            const y = node.y - node.h / 2;

            if (node.type === 'leaf') {
              this.drawCardNode(ctx, x, y, node);
            } else {
              this.drawPillNode(ctx, x, y, node);
            }
          });
        },

        drawCardNode: function (ctx, x, y, node) {
          const width = CONFIG.cardWidth;
          const height = 80;
          const borderRadius = 8;
          const padding = 14;

          ctx.fillStyle = '#ffffff';
          this.drawRoundedRect(ctx, x, y, width, height, borderRadius);
          ctx.fill();

          ctx.fillStyle = '#3498db';
          ctx.fillRect(x, y + borderRadius, 5, height - borderRadius * 2);

          ctx.shadowColor = 'rgba(0, 0, 0, 0.08)';
          ctx.shadowBlur = 12;
          ctx.shadowOffsetX = 0;
          ctx.shadowOffsetY = 4;

          ctx.fillStyle = '#ffffff';
          this.drawRoundedRect(ctx, x, y, width, height, borderRadius);
          ctx.fill();

          ctx.shadowColor = 'transparent';
          ctx.shadowBlur = 0;

          ctx.fillStyle = '#666666';
          ctx.font =
            '13px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif';
          ctx.textBaseline = 'middle';
          ctx.textAlign = 'left';

          const descMaxWidth = width - padding * 2;
          const lineHeight = 18;
          const maxHeight = height - padding * 2;

          const cleanDesc = cleanNodeText(node.desc || node.title || '');
          this.wrapText(
            ctx,
            cleanDesc,
            x + padding,
            y + height / 2,
            descMaxWidth,
            lineHeight,
            false,
          );
        },

        drawPillNode: function (ctx, x, y, node) {
          const width = CONFIG.pillWidth;
          const height = CONFIG.pillHeight;
          const borderRadius = 8;

          const isRoot = node.type === 'root';
          ctx.fillStyle = isRoot ? '#2c3e50' : '#34495e';

          this.drawRoundedRect(ctx, x, y, width, height, borderRadius);
          ctx.fill();

          ctx.strokeStyle = '#2c3e50';
          ctx.lineWidth = 1;
          this.drawRoundedRect(ctx, x, y, width, height, borderRadius);
          ctx.stroke();

          ctx.shadowColor = 'rgba(44, 62, 80, 0.3)';
          ctx.shadowBlur = 10;
          ctx.shadowOffsetX = 0;
          ctx.shadowOffsetY = 4;

          ctx.fillStyle = isRoot ? '#2c3e50' : '#34495e';
          this.drawRoundedRect(ctx, x, y, width, height, borderRadius);
          ctx.fill();

          ctx.shadowColor = 'transparent';
          ctx.shadowBlur = 0;

          ctx.fillStyle = '#ffffff';
          ctx.font = isRoot
            ? 'bold 16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif'
            : 'bold 14px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif';
          ctx.textAlign = 'center';
          ctx.textBaseline = 'middle';

          const textX = x + width / 2;
          const textY = y + height / 2;
          const textMaxWidth = width - 20;
          const lineHeight = 16;

          const cleanText = cleanNodeText(node.text || '');
          const textHeight = this.calcTextHeight(ctx, cleanText, textMaxWidth, lineHeight);
          const adjustedTextY = textY - (textHeight - lineHeight) / 2;

          this.wrapText(ctx, cleanText, textX, adjustedTextY, textMaxWidth, lineHeight, true);

          ctx.textAlign = 'left';
        },

        drawRoundedRect: function (ctx, x, y, width, height, radius) {
          ctx.beginPath();
          ctx.moveTo(x + radius, y);
          ctx.lineTo(x + width - radius, y);
          ctx.arcTo(x + width, y, x + width, y + radius, radius);
          ctx.lineTo(x + width, y + height - radius);
          ctx.arcTo(x + width, y + height, x + width - radius, y + height, radius);
          ctx.lineTo(x + radius, y + height);
          ctx.arcTo(x, y + height, x, y + height - radius, radius);
          ctx.lineTo(x, y + radius);
          ctx.arcTo(x, y, x + radius, y, radius);
          ctx.closePath();
        },

        wrapText: function (ctx, text, x, y, maxWidth, lineHeight, center = false) {
          if (!text || text.trim() === '') return y;

          const characters = text.split('');
          let line = '';
          let lineCount = 0;
          const originalTextAlign = ctx.textAlign;

          for (let i = 0; i < characters.length; i++) {
            const testLine = line + characters[i];
            const metrics = ctx.measureText(testLine);
            const testWidth = metrics.width;

            if ((testWidth > maxWidth && line.length > 0) || characters[i] === '\n') {
              if (center) {
                ctx.textAlign = 'center';
                ctx.fillText(line, x, y + lineCount * lineHeight);
                ctx.textAlign = originalTextAlign;
              } else {
                ctx.fillText(line, x, y + lineCount * lineHeight);
              }

              line = characters[i] === '\n' ? '' : characters[i];
              lineCount++;
            } else {
              line = testLine;
            }
          }

          if (line.trim() !== '') {
            if (center) {
              ctx.textAlign = 'center';
              ctx.fillText(line, x, y + lineCount * lineHeight);
              ctx.textAlign = originalTextAlign;
            } else {
              ctx.fillText(line, x, y + lineCount * lineHeight);
            }
          }

          return y + (lineCount + 1) * lineHeight;
        },

        calcTextHeight: function (ctx, text, maxWidth, lineHeight) {
          if (!text || text.trim() === '') return 0;

          const characters = text.split('');
          let line = '';
          let lineCount = 0;

          for (let i = 0; i < characters.length; i++) {
            const testLine = line + characters[i];
            const metrics = ctx.measureText(testLine);

            if ((metrics.width > maxWidth && line.length > 0) || characters[i] === '\n') {
              line = characters[i] === '\n' ? '' : characters[i];
              lineCount++;
            } else {
              line = testLine;
            }
          }

          if (line.trim() !== '') {
            lineCount++;
          }

          return lineCount * lineHeight;
        },

        truncateTextToLines: function (ctx, text, maxWidth, maxLines) {
          if (!text || text.trim() === '' || maxLines <= 0) return '';

          const characters = text.split('');
          let line = '';
          let lineCount = 0;
          let result = '';

          for (let i = 0; i < characters.length; i++) {
            const testLine = line + characters[i];
            const metrics = ctx.measureText(testLine);

            if ((metrics.width > maxWidth && line.length > 0) || characters[i] === '\n') {
              lineCount++;
              if (lineCount >= maxLines) {
                result += this.addEllipsisToLine(ctx, line, maxWidth);
                return result;
              }

              result += line + (characters[i] === '\n' ? '' : ' ');
              line = characters[i] === '\n' ? '' : characters[i];
            } else {
              line = testLine;
            }
          }

          if (line.trim() !== '') {
            lineCount++;
            if (lineCount <= maxLines) {
              result += line;
            } else {
              result += this.addEllipsisToLine(ctx, '', maxWidth);
            }
          }

          return result;
        },

        addEllipsisToLine: function (ctx, line, maxWidth) {
          const ellipsis = '...';
          const ellipsisWidth = ctx.measureText(ellipsis).width;

          if (ctx.measureText(line).width + ellipsisWidth <= maxWidth) {
            return line + ellipsis;
          }

          let truncated = line;
          while (truncated.length > 0 && ctx.measureText(truncated + ellipsis).width > maxWidth) {
            truncated = truncated.substring(0, truncated.length - 1);
          }

          return truncated + ellipsis;
        },

        getMindMapBounds: function () {
          let minX = Infinity,
            minY = Infinity,
            maxX = -Infinity,
            maxY = -Infinity;

          flatNodes.forEach(node => {
            const x = node.x;
            const y = node.y - node.h / 2;
            const right = x + node.w;
            const bottom = y + node.h;

            minX = Math.min(minX, x);
            minY = Math.min(minY, y);
            maxX = Math.max(maxX, right);
            maxY = Math.max(maxY, bottom);
          });
          return {
            x: minX,
            y: minY,
            width: maxX - minX,
            height: maxY - minY,
          };
        },

        drawMindMapToCanvas: function (ctx, bounds, padding) {
          const offsetX = padding - bounds.x;
          const offsetY = padding - bounds.y;

          flatNodes.forEach(node => {
            const x = node.x + offsetX;
            const y = node.y - node.h / 2 + offsetY;

            if (node.type === 'leaf') {
              this.drawCardNode(ctx, x, y, node);
            } else {
              this.drawPillNode(ctx, x, y, node);
            }
          });

          ctx.strokeStyle = '#bdc3c7';
          ctx.lineWidth = 2;
          ctx.lineCap = 'round';

          flatNodes.forEach(node => {
            if (node.children && node.children.length > 0 && !node.collapsed) {
              const startX = node.x + offsetX + node.w;
              const startY = node.y + offsetY;

              node.children.forEach(child => {
                const endX = child.x + offsetX;
                const endY = child.y + offsetY;

                const cpOffset = CONFIG.nodeXGap * 0.6;

                ctx.beginPath();
                ctx.moveTo(startX, startY);
                ctx.bezierCurveTo(startX + cpOffset, startY, endX - cpOffset, endY, endX, endY);
                ctx.stroke();
              });
            }
          });
        },

        showBrowserDownload: function (imageData) {
          const link = document.createElement('a');
          link.download = '思维导图-' + new Date().toISOString().split('T')[0] + '.png';
          link.href = imageData;
          link.click();
        },

        debug: function (...args) {
          if (debugPanel) {
            debugPanel.textContent = args
              .map(arg => (typeof arg === 'object' ? JSON.stringify(arg) : arg))
              .join(' ');
            debugPanel.style.display = 'block';
            setTimeout(() => {
              debugPanel.style.display = 'none';
            }, 3000);
          }
        },
      };

      // --- 4. 增强的缩放管理器 ---
      class EnhancedZoomManager {
        constructor() {
          this.scale = 1.0;
          this.translateX = 0;
          this.translateY = 0;
          this.minScale = 0.2;
          this.maxScale = 3.0;
          this.scaleStep = 0.1;

          this.isPinching = false;
          this.isDragging = false;
          this.wasPinching = false;
          this.pinchEndTime = 0;

          this.initialPinch = {
            distance: 0,
            scale: 1.0,
            centerX: 0,
            centerY: 0,
            translateX: 0,
            translateY: 0,
          };

          this.dragStart = { x: 0, y: 0 };
          this.activeTouches = new Map();
        }

        updateDisplay() {
          // 移除了缩放百分比显示
        }

        applyTransform() {
          const transform = `translate3d(${this.translateX}px, ${this.translateY}px, 0) scale(${this.scale})`;
          canvas.style.transform = transform;
          canvas.style.webkitTransform = transform;
        }

        smoothTransform(targetTranslateX, targetTranslateY, targetScale, duration = 300) {
          const startTranslateX = this.translateX;
          const startTranslateY = this.translateY;
          const startScale = this.scale;
          const startTime = Date.now();

          const animate = () => {
            const elapsed = Date.now() - startTime;
            const progress = Math.min(elapsed / duration, 1);
            const ease = 1 - Math.pow(1 - progress, 3);

            this.translateX = startTranslateX + (targetTranslateX - startTranslateX) * ease;
            this.translateY = startTranslateY + (targetTranslateY - startTranslateY) * ease;
            this.scale = startScale + (targetScale - startScale) * ease;

            this.applyTransform();

            if (progress < 1) {
              requestAnimationFrame(animate);
            }
          };

          animate();
        }

        zoomBy(delta) {
          const rect = viewport.getBoundingClientRect();
          const centerX = rect.width / 2;
          const centerY = rect.height / 2;

          const targetScale = Math.max(this.minScale, Math.min(this.maxScale, this.scale + delta));
          if (Math.abs(targetScale - this.scale) < 0.001) return;

          const canvasX = (centerX - this.translateX) / this.scale;
          const canvasY = (centerY - this.translateY) / this.scale;

          const targetTranslateX = centerX - canvasX * targetScale;
          const targetTranslateY = centerY - canvasY * targetScale;

          this.smoothTransform(targetTranslateX, targetTranslateY, targetScale);
        }

        resetView() {
          const viewportW = document.body.clientWidth;
          const viewportH = document.body.clientHeight;

          const targetScreenX = viewportW * 0.3;
          const targetScreenY = viewportH / 2;

          const targetX = targetScreenX - mindMapData.x;
          const targetY = targetScreenY - mindMapData.y;

          this.smoothTransform(targetX, targetY, 1.0);
        }

        trackTouch(touch) {
          this.activeTouches.set(touch.identifier, {
            id: touch.identifier,
            clientX: touch.clientX,
            clientY: touch.clientY,
            timestamp: Date.now(),
          });
        }

        untrackTouch(touch) {
          this.activeTouches.delete(touch.identifier);
        }

        startPinch(touches) {
          this.isPinching = true;
          this.wasPinching = false;

          const touch1 = touches[0];
          const touch2 = touches[1];

          this.trackTouch(touch1);
          this.trackTouch(touch2);

          const dx = touch2.clientX - touch1.clientX;
          const dy = touch2.clientY - touch1.clientY;
          this.initialPinch.distance = Math.sqrt(dx * dx + dy * dy);

          this.initialPinch.centerX = (touch1.clientX + touch2.clientX) / 2;
          this.initialPinch.centerY = (touch1.clientY + touch2.clientY) / 2;

          this.initialPinch.scale = this.scale;
          this.initialPinch.translateX = this.translateX;
          this.initialPinch.translateY = this.translateY;
        }

        updatePinch(touches) {
          if (!this.isPinching || touches.length < 2) return;

          const touch1 = touches[0];
          const touch2 = touches[1];

          this.trackTouch(touch1);
          this.trackTouch(touch2);

          const dx = touch2.clientX - touch1.clientX;
          const dy = touch2.clientY - touch1.clientY;
          const currentDistance = Math.sqrt(dx * dx + dy * dy);

          const currentCenterX = (touch1.clientX + touch2.clientX) / 2;
          const currentCenterY = (touch1.clientY + touch2.clientY) / 2;

          const scaleFactor = currentDistance / this.initialPinch.distance;
          let newScale = this.initialPinch.scale * scaleFactor;
          newScale = Math.max(this.minScale, Math.min(this.maxScale, newScale));

          const rect = viewport.getBoundingClientRect();
          const initialViewportX = this.initialPinch.centerX - rect.left;
          const initialViewportY = this.initialPinch.centerY - rect.top;

          const currentViewportX = currentCenterX - rect.left;
          const currentViewportY = currentCenterY - rect.top;

          const initialCanvasX =
            (initialViewportX - this.initialPinch.translateX) / this.initialPinch.scale;
          const initialCanvasY =
            (initialViewportY - this.initialPinch.translateY) / this.initialPinch.scale;

          this.translateX = currentViewportX - initialCanvasX * newScale;
          this.translateY = currentViewportY - initialCanvasY * newScale;
          this.scale = newScale;

          this.applyTransform();
          this.updateDisplay();
        }

        endPinch() {
          this.isPinching = false;
          this.wasPinching = true;
          this.pinchEndTime = Date.now();

          this.activeTouches.clear();

          setTimeout(() => {
            const timeSincePinch = Date.now() - this.pinchEndTime;
            if (timeSincePinch > 300) {
              this.wasPinching = false;
            }
          }, 300);
        }

        canStartDrag() {
          if (this.wasPinching) {
            const timeSincePinch = Date.now() - this.pinchEndTime;
            return timeSincePinch > 150;
          }
          return true;
        }

        startDrag(clientX, clientY) {
          if (!this.canStartDrag()) {
            return;
          }

          this.isDragging = true;
          this.dragStart.x = clientX - this.translateX;
          this.dragStart.y = clientY - this.translateY;
        }

        updateDrag(clientX, clientY) {
          if (!this.isDragging) return;

          this.translateX = clientX - this.dragStart.x;
          this.translateY = clientY - this.dragStart.y;

          this.applyTransform();
        }

        endDrag() {
          this.isDragging = false;
        }

        isMultiTouchInProgress() {
          return this.activeTouches.size >= 2;
        }
      }

      const zoomManager = new EnhancedZoomManager();

      // --- 5. 思维导图渲染 ---
      function initDataRecursive(node, level) {
        if (level >= 1 && node.children) {
          node.collapsed = true;
        }
        if (node.children) {
          node.children.forEach(c => initDataRecursive(c, level + 1));
        }
      }

      function layoutTree(node) {
        const isLeaf = node.type === 'leaf';
        node.w = isLeaf ? CONFIG.cardWidth : CONFIG.pillWidth;
        node.h = isLeaf ? CONFIG.cardHeight : CONFIG.pillHeight;

        if (!node.children || node.children.length === 0 || node.collapsed) {
          node.treeHeight = node.h + CONFIG.nodeYGap;
          return;
        }

        let childrenTotalHeight = 0;
        node.children.forEach(child => {
          layoutTree(child);
          childrenTotalHeight += child.treeHeight;
        });
        node.treeHeight = childrenTotalHeight;
      }

      function assignCoordinates(node, x, y) {
        node.x = x;

        if (!node.children || node.children.length === 0 || node.collapsed) {
          node.y = y;
          flatNodes.push(node);
          return;
        }

        let startY = y - node.treeHeight / 2;
        let cursorY = startY;

        node.children.forEach(child => {
          const childCenterY = cursorY + child.treeHeight / 2;
          assignCoordinates(child, x + node.w + CONFIG.nodeXGap, childCenterY);
          cursorY += child.treeHeight;
        });

        node.y = y;
        flatNodes.push(node);
      }

      function render(preserveViewportPosition = false) {
        let viewportCenterCanvasX = 0;
        let viewportCenterCanvasY = 0;

        if (preserveViewportPosition) {
          const rect = viewport.getBoundingClientRect();
          const viewportCenterX = rect.width / 2;
          const viewportCenterY = rect.height / 2;

          viewportCenterCanvasX = (viewportCenterX - zoomManager.translateX) / zoomManager.scale;
          viewportCenterCanvasY = (viewportCenterY - zoomManager.translateY) / zoomManager.scale;
        }

        domLayer.innerHTML = '';
        svgLayer.innerHTML = '';
        flatNodes = [];

        layoutTree(mindMapData);
        assignCoordinates(mindMapData, 50, 400);

        flatNodes.forEach(node => {
          const el = document.createElement('div');
          el.className = `node ${node.type === 'root' ? 'is-root' : ''}`;
          el.style.left = `${node.x}px`;
          el.style.top = `${node.y - node.h / 2}px`;

          let contentHTML = '';
          if (node.type === 'leaf') {
            contentHTML = `
          <div class="node-card">
            <div class="card-desc">${cleanNodeText(node.title)}</div>
          </div>
        `;
          } else {
            contentHTML = `
          <div class="node-pill" onclick="toggleNode('${node.id}', event)">
            ${cleanNodeText(node.text)}
          </div>
        `;
          }

          if (node.children && node.children.length > 0) {
            contentHTML += `
          <div class="toggle-btn ${node.collapsed ? 'collapsed' : ''}"
               onclick="toggleNode('${node.id}', event)">
               ${node.collapsed ? '+' : '-'}
          </div>
        `;
          }

          el.innerHTML = contentHTML;
          domLayer.appendChild(el);
        });

        flatNodes.forEach(node => {
          if (node.children && node.children.length > 0 && !node.collapsed) {
            const startX = node.x + node.w;
            const startY = node.y;

            node.children.forEach(child => {
              const endX = child.x;
              const endY = child.y;

              const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
              const cpOffset = CONFIG.nodeXGap * 0.6;
              const d = `M ${startX} ${startY} C ${startX + cpOffset} ${startY}, ${
                endX - cpOffset
              } ${endY}, ${endX} ${endY}`;

              path.setAttribute('d', d);
              path.setAttribute('class', 'connection');
              svgLayer.appendChild(path);
            });
          }
        });

        if (preserveViewportPosition) {
          const rect = viewport.getBoundingClientRect();
          const viewportCenterX = rect.width / 2;
          const viewportCenterY = rect.height / 2;

          zoomManager.translateX = viewportCenterX - viewportCenterCanvasX * zoomManager.scale;
          zoomManager.translateY = viewportCenterY - viewportCenterCanvasY * zoomManager.scale;
          zoomManager.applyTransform();
        }

        zoomManager.updateDisplay();
      }

      // --- 6. 节点交互 ---
      function findNode(node, id) {
        if (node.id === id) return node;
        if (node.children) {
          for (let child of node.children) {
            const res = findNode(child, id);
            if (res) return res;
          }
        }
        return null;
      }

      window.toggleNode = function (id, event) {
        if (event) event.stopPropagation();

        const node = findNode(mindMapData, id);
        if (node) {
          node.collapsed = !node.collapsed;
          render(true);
        }
      };

      // --- 一键展开/折叠功能 ---
      function expandAllNodes() {
        function expandRecursive(node) {
          if (node.children) {
            node.collapsed = false;
            node.children.forEach(child => expandRecursive(child));
          }
        }
        expandRecursive(mindMapData);
        render(true);
      }

      function collapseAllNodes() {
        function collapseRecursive(node) {
          if (node.children) {
            if (node.type !== 'root') {
              node.collapsed = true;
            }
            node.children.forEach(child => collapseRecursive(child));
          }
        }
        collapseRecursive(mindMapData);
        render(true);
      }

      function toggleExpandCollapseAll() {
        if (isAllExpanded) {
          collapseAllNodes();
        } else {
          expandAllNodes();
        }

        isAllExpanded = !isAllExpanded;
        updateExpandCollapseButton();
      }

      function updateExpandCollapseButton() {
        const toggleBtn = document.getElementById('toggle-expand-btn');

        if (isAllExpanded) {
          toggleBtn.classList.remove('collapsed');
          toggleBtn.classList.add('expanded');
        } else {
          toggleBtn.classList.remove('expanded');
          toggleBtn.classList.add('collapsed');
        }
      }

      // --- 7. 改进的事件处理 ---
      function setupEventListeners() {
        document.getElementById('zoom-in-btn').addEventListener('click', () => {
          zoomManager.zoomBy(zoomManager.scaleStep);
        });

        document.getElementById('zoom-out-btn').addEventListener('click', () => {
          zoomManager.zoomBy(-zoomManager.scaleStep);
        });

        document.getElementById('toggle-expand-btn').addEventListener('click', () => {
          toggleExpandCollapseAll();
        });

        // 修改：下载完整导图按钮 - 现在会添加水印
        document.getElementById('download-full-btn').addEventListener('click', async () => {
          RNInterface.postMessage('download_started', {
            action: 'full_map_download',
            timestamp: Date.now(),
            buttonId: 'download-full-btn',
          });
          try {
            const quality = 0.6;

            const imageData = await RNInterface.generateFullMapScreenshot(quality);

            const cleanedImageData = imageData.replace(/\n/g, '');

            // 添加水印
            let watermarkedImageData = cleanedImageData;
            if (RNInterface.WATERMARK_CONFIG.enabled) {
              try {
                const img = new Image();
                await new Promise(resolve => {
                  img.onload = () => {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');

                    canvas.width = img.width;
                    canvas.height = img.height;

                    ctx.drawImage(img, 0, 0);

                    // 绘制水印
                    RNInterface.drawWatermark(ctx, img.width, img.height);

                    watermarkedImageData = canvas.toDataURL('image/png', quality);
                    resolve();
                  };
                  img.onerror = () => {
                    watermarkedImageData = cleanedImageData;
                    resolve();
                  };
                  img.src = cleanedImageData;
                });
              } catch (watermarkError) {
                watermarkedImageData = cleanedImageData;
              }
            }

            const optimizedImageData = await RNInterface.optimizeBase64Size(
              watermarkedImageData,
              'full_map_download',
            );

            RNInterface.postMessage('save_image', {
              imageData: optimizedImageData,
              viewType: 'full',
              quality: quality,
              optimized: cleanedImageData !== optimizedImageData,
              originalSize: cleanedImageData.length,
              finalSize: optimizedImageData.length,
              watermarked:
                RNInterface.WATERMARK_CONFIG.enabled && cleanedImageData !== watermarkedImageData,
            });
          } catch (error) {
            RNInterface.debug('完整导图截图失败:', error.message);
          }
          setTimeout(() => {
            RNInterface.postMessage('download_started', {
              action: 'full_map_error',
              timestamp: Date.now(),
              buttonId: 'download-full-btn',
            });
          }, 500);
        });

        document.getElementById('zoom-reset').addEventListener('click', () => {
          zoomManager.resetView();
        });

        viewport.addEventListener('wheel', e => {
          e.preventDefault();

          if (e.ctrlKey || e.metaKey) {
            const delta = e.deltaY > 0 ? -zoomManager.scaleStep : zoomManager.scaleStep;
            zoomManager.zoomBy(delta);
          }
        });

        viewport.addEventListener(
          'touchstart',
          e => {
            if (e.touches.length > 1) {
              e.preventDefault();
            }

            if (e.touches.length === 2) {
              e.preventDefault();
              e.stopPropagation();

              if (zoomManager.isDragging) {
                zoomManager.endDrag();
              }

              zoomManager.startPinch(e.touches);
            } else if (e.touches.length === 1 && !zoomManager.isPinching) {
              const target = e.target;
              if (
                target.closest('.node-pill') ||
                target.closest('.toggle-btn') ||
                target.closest('.action-btn') ||
                target.closest('.control-btn') ||
                target.closest('.reset-view-btn')
              ) {
                return;
              }

              zoomManager.trackTouch(e.touches[0]);

              setTimeout(() => {
                if (!zoomManager.isPinching && !zoomManager.wasPinching) {
                  zoomManager.startDrag(e.touches[0].clientX, e.touches[0].clientY);
                }
              }, 50);
            }
          },
          { passive: false },
        );

        viewport.addEventListener(
          'touchmove',
          e => {
            if (e.touches.length === 2) {
              e.preventDefault();
              e.stopPropagation();
              zoomManager.updatePinch(e.touches);
            } else if (
              e.touches.length === 1 &&
              zoomManager.isDragging &&
              !zoomManager.isPinching &&
              !zoomManager.isMultiTouchInProgress()
            ) {
              e.preventDefault();
              zoomManager.trackTouch(e.touches[0]);
              zoomManager.updateDrag(e.touches[0].clientX, e.touches[0].clientY);
            }
          },
          { passive: false },
        );

        viewport.addEventListener('touchend', e => {
          for (let touch of e.changedTouches) {
            zoomManager.untrackTouch(touch);
          }

          if (zoomManager.isPinching && e.touches.length < 2) {
            zoomManager.endPinch();
          }

          if (zoomManager.isDragging && e.touches.length === 0 && !zoomManager.isPinching) {
            zoomManager.endDrag();
          }
        });

        viewport.addEventListener('touchcancel', e => {
          for (let touch of e.changedTouches) {
            zoomManager.untrackTouch(touch);
          }

          if (zoomManager.isPinching) {
            zoomManager.endPinch();
          }

          if (zoomManager.isDragging) {
            zoomManager.endDrag();
          }
        });

        viewport.addEventListener('pointerdown', e => {
          if (e.pointerType === 'touch') return;

          if (
            e.target.closest('.node-pill') ||
            e.target.closest('.toggle-btn') ||
            e.target.closest('.action-btn') ||
            e.target.closest('.control-btn') ||
            e.target.closest('.reset-view-btn')
          ) {
            return;
          }

          zoomManager.startDrag(e.clientX, e.clientY);
          viewport.style.cursor = 'grabbing';
        });

        window.addEventListener('pointermove', e => {
          if (e.pointerType === 'touch') return;

          if (zoomManager.isDragging) {
            e.preventDefault();
            zoomManager.updateDrag(e.clientX, e.clientY);
          }
        });

        window.addEventListener('pointerup', e => {
          if (e.pointerType === 'touch') return;

          if (zoomManager.isDragging) {
            zoomManager.endDrag();
            viewport.style.cursor = 'grab';
          }
        });

        document.addEventListener('gesturestart', e => e.preventDefault());
        document.addEventListener('gesturechange', e => e.preventDefault());
        document.addEventListener('gestureend', e => e.preventDefault());
      }

      // --- 8. 初始化 ---
      function initializeApp() {
        initDataRecursive(mindMapData, 0);
        render();

        const viewportW = document.body.clientWidth;
        const viewportH = document.body.clientHeight;
        const targetScreenX = viewportW * 0.3;
        const targetScreenY = viewportH / 2;

        zoomManager.translateX = targetScreenX - mindMapData.x;
        zoomManager.translateY = targetScreenY - mindMapData.y;
        zoomManager.applyTransform();
        zoomManager.updateDisplay();

        function initializeButtonState() {
          const toggleBtn = document.getElementById('toggle-expand-btn');
          toggleBtn.classList.add('collapsed');
          isAllExpanded = false;
        }

        initializeButtonState();
        setupEventListeners();
        RNInterface.setupMessageListener();

        setTimeout(() => {
          RNInterface.postMessage('webview_ready', {
            ready: true,
            version: '1.0.0',
          });

          RNInterface.requestData();
        }, 100);
      }

      window.addEventListener('load', () => {
        initializeApp();
      });

      window.RNInterface = RNInterface;
      window.mindMapData = mindMapData;
      window.expandAllNodes = expandAllNodes;
      window.collapseAllNodes = collapseAllNodes;
      window.toggleExpandCollapseAll = toggleExpandCollapseAll;

      window.saveScreenshot = function (viewType = 'current') {
        RNInterface.handleScreenshotRequest(viewType);
      };

      window.getCurrentViewScreenshot = function () {
        return RNInterface.generateCurrentViewScreenshot();
      };

      window.getFullMapScreenshot = function () {
        return RNInterface.generateFullMapScreenshot();
      };

      window.updateMindMapData = function (newData) {
        RNInterface.updateData(newData);
      };

      window.clearMindMapData = function () {
        RNInterface.clearData();
      };

      window.requestMindMapData = function () {
        RNInterface.requestData();
      };
    </script>
  </body>
</html>
